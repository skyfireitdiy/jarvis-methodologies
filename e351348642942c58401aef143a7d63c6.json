{
  "problem_type": "代码重构-将子类功能下沉到基类",
  "content": "问题重述：\n如何将某个子类独有的功能模块迁移到基类，使其对所有子类都可使用，同时保持向后兼容性和避免冲突。\n\n可复用解决流程：\n\n1. **识别待下沉功能**\n   - 分析子类的独有功能模块\n   - 评估该功能是否对其他子类也有价值\n   - 确认依赖关系（文件依赖、类依赖）\n\n2. **迁移核心模块**\n   - 将功能模块文件移动到基类目录\n   - 更新模块内的导入路径\n   - 修复模块内的路径引用（如从 src/jarvis/jarvis_code_agent/xxx 到 src/jarvis/jarvis_agent/xxx）\n\n3. **修改基类**\n   - 在基类 __init__ 中添加参数（保持可选，默认值为 None）\n   - 在文档字符串中添加参数说明\n   - 在合适的初始化方法中创建功能实例\n   - **关键**：使用条件判断避免覆盖子类的实例\n     ```python\n     if not hasattr(self, \"feature_manager\"):\n         self.feature_manager = FeatureManager(...)\n     ```\n\n4. **更新子类**\n   - 保持子类的参数传递（或直接使用基类的参数）\n   - 如果子类需要特殊处理，保留其独立实现\n\n5. **更新中间层（如果有）**\n   - 如果有中间管理层（如 AgentManager），添加参数传递\n   - 更新 __init__ 和初始化方法\n\n6. **添加命令行参数（如需要）**\n   - 在 CLI 入口（如 run_cli）添加命令行参数\n   - 将参数传递到中间层 → 基类\n\n7. **验证测试**\n   - 编译验证：确保所有导入正确\n   - 功能验证：测试功能模块是否正常工作\n   - 兼容性验证：确保现有功能不受影响\n\n注意事项：\n\n1. **兼容性优先**：所有新参数都必须是可选的，默认值不影响现有代码\n2. **避免冲突**：使用 hasattr 条件判断，避免覆盖子类的属性\n3. **参数传递链**：确保从命令行到基类的参数传递链完整\n4. **测试覆盖**：每个修改后都要进行编译验证\n5. **保持风格**：遵循项目的代码规范和风格\n\n可选步骤：\n\n- 如果功能涉及多个文件，考虑创建任务列表进行管理\n- 如果修改范围较大，可以先在测试环境验证\n- 记录架构决策到项目长期记忆",
  "scope": "global"
}