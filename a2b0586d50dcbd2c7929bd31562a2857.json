{
  "problem_type": "CLI工具扩展",
  "content": "# CLI工具扩展方法论\n\n## 问题重述\n为现有的Python CLI工具（基于typer）添加新功能或扩展功能，需要修改配置、核心逻辑和命令行接口等多个层次，同时保持向后兼容性和代码风格一致性。\n\n## 可复用解决流程\n\n### 1. 需求分析阶段\n- 明确要扩展的功能（如新增检查类型、新增命令等）\n- 确定需要修改的模块和文件\n- 分析现有代码结构，理解配置、核心逻辑、CLI的分层架构\n- 确认向后兼容性要求和约束条件\n\n### 2. 设计方案阶段\n- 设计新的配置结构（如添加新的配置字典）\n- 设计新的核心方法或扩展现有方法\n- 设计新的命令行选项和参数\n- 规划选项互斥和优先级逻辑\n\n### 3. 实现阶段\n\n#### 3.1 配置层扩展\n- 在config.py中添加新的配置字典\n- 保持配置结构一致：name, command, description, install_hint等\n- 添加对应的获取函数（如get_xxx_config()）\n\n#### 3.2 核心逻辑层扩展\n- 在core.py中添加新方法（如check_xxx_tools()）\n- 复用现有的基础方法（如check_single_tool()）\n- 保持返回格式一致（如List[Dict[str, Any]]）\n- 在__init__中初始化新配置\n\n#### 3.3 CLI层扩展\n- 在cli.py的命令函数中添加新选项（typer.Option）\n- 实现选项互斥检查（如sum([option1, option2]) > 1）\n- 根据选项调用不同的核心方法\n- 保持默认行为不变，确保向后兼容\n\n#### 3.4 类型检查修复\n- 运行mypy进行类型检查\n- 修复类型不匹配错误（如auto_print vs print）\n- 确保所有类型注解正确\n\n### 4. 测试验证阶段\n- 测试默认行为（不带参数）\n- 测试新增选项（如--check-lint）\n- 测试选项互斥（同时指定多个选项）\n- 测试JSON输出兼容性（--json选项）\n- 验证输出格式一致性\n\n### 5. 文档和记忆\n- 更新相关文档（如README、使用说明）\n- 保存关键信息到记忆系统\n- 总结经验教训\n\n## 注意事项\n\n1. **向后兼容性**\n   - 默认行为必须保持不变\n   - 新增功能应该是可选的\n   - 不破坏现有的API和接口\n\n2. **代码一致性**\n   - 保持配置结构一致\n   - 保持返回格式一致\n   - 保持输出格式一致（彩色emoji输出）\n\n3. **错误处理**\n   - 实现选项互斥检查\n   - 提供清晰的错误提示\n   - 正确处理工具不存在的情况\n\n4. **类型安全**\n   - 确保通过mypy类型检查\n   - 注意函数参数类型匹配\n   - 正确使用Optional等类型注解\n\n5. **测试覆盖**\n   - 测试所有新增选项\n   - 测试边界情况\n   - 测试与现有功能的交互\n\n## 可选步骤\n\n- 如果扩展涉及多个独立的子功能，使用task_list_manager拆分任务\n- 如果需要添加大量工具配置，考虑从外部文件加载配置\n- 如果功能复杂，考虑创建子命令而不是添加选项\n\n## 使用示例\n\n```python\n# 1. config.py - 添加配置\nNEW_TOOLS_CONFIG = [\n    {\n        \"name\": \"tool_name\",\n        \"command\": \"command\",\n        \"description\": \"工具描述\",\n        \"install_hint\": \"安装建议\",\n    }\n]\n\ndef get_new_tools_config():\n    return NEW_TOOLS_CONFIG\n\n# 2. core.py - 添加方法\ndef check_new_tools(self):\n    results = []\n    for tool_config in self.new_tools_config:\n        result = self.check_single_tool(tool_config[\"name\"])\n        results.append(result)\n    return results\n\n# 3. cli.py - 添加选项\ndef check(\n    check_new: bool = typer.Option(False, \"--check-new\", \"-n\", help=\"检查新工具\"),\n):\n    if check_new:\n        results = checker.check_new_tools()\n    else:\n        results = checker.check_all_tools()\n```",
  "scope": "global"
}