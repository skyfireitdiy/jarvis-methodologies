{
  "problem_type": "嵌入式文件系统Rust移植",
  "content": "## 问题重述\n将C语言实现的嵌入式文件系统（如littlefs）功能安全移植到Rust，需保持功能等价性同时利用Rust的安全特性。\n\n## 可复用解决流程\n1. **环境分析**（RESEARCH模式）\n   - 使用read_code分析原始C代码结构和关键数据结构\n   - 识别内存管理、错误处理、并发访问模式\n   - 记录所有依赖函数和宏定义\n\n2. **TDD测试设计**（INNOVATE→PLAN模式）\n   - Red阶段：设计5类测试用例\n     * 基础功能测试（正常路径）\n     * 边界条件测试（内存对齐、最大块数）\n     * 状态保持测试（不破坏现有数据）\n     * 错误路径测试（内存不足、无效参数）\n     * 辅助函数测试（对齐计算等）\n   - 使用execute_script运行`cargo test`验证测试编译\n\n3. **安全移植实现**（EXECUTE模式）\n   - 数据结构：C struct → Rust struct + Default trait\n   - 函数签名：返回int → Result<(), LfsError>\n   - 内存管理：手动malloc → Rust自动内存管理\n   - 错误处理：错误码 → LfsError::Other包装\n   - 类型转换：uint32_t → u32，指针 → 引用/Box\n\n4. **冲突解决策略**\n   - 借用检查器冲突：使用*const/raw指针隔离\n   - 生命周期问题：通过结构体字段所有权重新设计\n   - 不安全代码：最小化unsafe块，明确标注\n\n5. **验证闭环**\n   - 所有测试通过（cargo test）\n   - 代码格式化（cargo fmt）\n   - 静态检查（cargo clippy）\n   - 清理临时文件（/tmp下备份）\n\n## 注意事项\n- 保持原始算法逻辑不变，避免优化\n- 优先安全抽象，性能优化后续进行\n- 每个unsafe块需添加安全注释\n- 测试用例必须覆盖C代码的所有分支\n\n## 可选步骤\n- 实现真实依赖函数（如lfs_alloc）\n- 添加proptest进行属性测试\n- 基准测试对比C/Rust性能"
}