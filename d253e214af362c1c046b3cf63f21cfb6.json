{
  "problem_type": "Rust原子操作返回值设计模式",
  "content": "问题重述：\n在使用Rust原子操作（如AtomicUsize::fetch_add/fetch_sub）时，需要决定函数应该返回操作前的旧值还是操作后的新值，这直接影响测试设计和API一致性。\n\n可复用解决流程：\n1. **明确语义**：确定函数是查询型（返回当前状态）还是操作型（返回操作结果）\n2. **检查原子操作行为**：确认fetch_add/fetch_sub返回的是操作前的旧值\n3. **API设计决策**：\n   - 如果函数模拟C语言行为，通常返回操作前的旧值\n   - 如果需要返回新值，使用wrapping_add/wrapping_sub计算\n4. **测试验证**：编写测试验证返回值是否符合预期语义\n5. **文档说明**：清晰说明函数返回的是操作前还是操作后的状态\n\n注意事项：\n- Atomic操作返回的是旧值（操作前）\n- 需要区分API返回语义与底层原子操作行为\n- 测试用例应明确期望的返回值\n\n可选步骤：\n- 添加调试输出验证实际行为\n- 使用wrapping_系列方法处理边界情况\n- 考虑添加类型别名明确语义"
}