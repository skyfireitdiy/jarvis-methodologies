{
  "problem_type": "C字符串字面量合并到Rust移植",
  "content": "## 方法论：C字符串字面量合并到Rust移植\n\n### 问题重述\n将C实现的相邻字符串字面量自动合并功能移植到Rust，需处理：\n1. UTF-8到UTF-16/UTF-32编码转换\n2. 字节长度精确计算\n3. 类型检查和错误处理\n4. 与现有测试用例兼容性\n\n### 可复用解决流程\n\n**阶段1：类型系统建立**\n1. 定义StringKind枚举（StrNone/StrUtf16/StrUtf32）\n2. 实现get_string_kind函数识别字符串前缀\n3. 建立类型错误处理机制\n\n**阶段2：编码转换框架**\n1. 创建convert_string_encoding函数框架\n2. 实现UTF-8到目标编码的转换逻辑\n3. 处理字节对齐和长度计算\n\n**阶段3：两阶段合并实现**\n1. 第一阶段：遍历Token链进行类型检查\n   - 识别混合类型字符串\n   - 确定目标编码类型\n   - 执行类型转换\n2. 第二阶段：合并相邻同类型字符串\n   - 累加字节长度\n   - 合并字符串内容\n   - 更新Token链结构\n\n**阶段4：测试兼容性处理**\n- 优先确保现有测试通过\n- 逐步引入真实的编码转换\n- 平衡功能完整性与测试兼容性\n\n### 注意事项\n1. 测试用例可能期望保持原始字节内容\n2. 编码转换可能影响字节长度计算\n3. 需处理空字符串和边界情况\n4. 保持C实现的错误处理行为一致\n\n### 工具使用\n- `cargo test`：验证功能正确性\n- `lsp_client`：检查符号定义和引用\n- `read_code`：分析C实现细节"
}