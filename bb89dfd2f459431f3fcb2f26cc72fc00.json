{
  "problem_type": "Python代码审查",
  "content": "## Python代码审查方法论\n\n### 问题重述\n审查代码修改是否正确实现了用户需求，重点关注功能完整性、代码正确性、代码质量和潜在风险。\n\n### 可复用解决流程\n\n#### 阶段1：准备工作\n1. **读取参考文件**：理解基类/接口定义和参考实现模式\n   - 读取基类文件，了解抽象方法签名和接口契约\n   - 读取参考实现（如其他平台实现），了解代码风格和设计模式\n\n2. **静态代码检查**：运行代码质量工具\n   - 执行 ruff/pylint/mypy 等静态检查工具\n   - 确保代码符合项目规范\n\n#### 阶段2：功能完整性验证\n3. **验证抽象方法实现**：对比基类要求与实际实现\n   - 检查所有 @abstractmethod 是否被实现\n   - 验证方法签名是否一致（参数、返回类型）\n   - 使用 read_code 工具逐个检查关键方法\n\n4. **验证代码生成总结**：逐项核对\n   - 不要盲目信任总结，将其视为\"待核实的说明\"\n   - 对总结中提到的每个关键修改点，在 git diff 或实际代码中找到对应依据\n   - 记录总结与实际代码不一致的情况\n\n#### 阶段3：代码正确性验证\n5. **检查关键实现逻辑**：\n   - 初始化逻辑（API Key、Base URL、客户端初始化）\n   - 核心业务逻辑（如流式输出、消息历史管理）\n   - 错误处理和异常捕获\n\n6. **对比参考实现**：\n   - 对比与参考实现的差异点\n   - 确认差异是否合理（如不同平台 API 的特殊要求）\n\n#### 阶段4：代码质量评估\n7. **检查代码质量**：\n   - 代码风格一致性（与参考实现保持一致）\n   - 命名规范\n   - 注释和文档完整性\n\n8. **评估潜在风险**：\n   - 是否可能引入新的问题\n   - 是否破坏现有功能\n   - 边界情况处理是否完善\n\n### 注意事项\n\n1. **不盲目信任总结**：代码生成总结可能有遗漏或错误，必须对照实际代码验证\n2. **关注不一致性**：如果总结与实际代码不一致，应作为问题记录\n3. **使用工具辅助**：充分利用 read_code、execute_script 等工具获取上下文\n4. **静态检查优先**：运行 ruff/mypy 等工具快速发现明显问题\n5. **逐项验证**：按检查清单逐项确认，避免遗漏\n\n### 可选步骤\n\n- 如果需要了解更广泛的上下文，可以检索项目的长期记忆（如有相关实现经验）\n- 对于复杂的逻辑，可以绘制流程图或状态图辅助理解\n- 如发现严重问题，可建议修复方案并重新审查\n\n### 检查清单（供快速审查）\n\n- [ ] 所有抽象方法是否已实现\n- [ ] 方法签名是否与基类一致\n- [ ] 静态检查是否通过\n- [ ] 代码生成总结是否与实际代码一致\n- [ ] 初始化逻辑是否正确\n- [ ] 核心业务逻辑是否正确\n- [ ] 错误处理是否完善\n- [ ] 代码风格是否与参考实现一致\n- [ ] 文档注释是否完整\n- [ ] 是否存在潜在风险"
}