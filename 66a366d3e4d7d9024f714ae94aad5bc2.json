{
  "problem_type": "修复Rust测试中全局状态污染问题",
  "content": "|||\n## 问题重述\n在Rust项目中，静态全局变量（如原子计数器、Mutex保护的集合等）在测试间保持状态，导致测试用例间产生依赖，造成测试结果不稳定或失败。\n\n## 可复用解决流程\n\n### 步骤1：识别问题症状\n- 测试用例单独运行通过，批量运行失败\n- 测试期望值与实际值存在固定偏移（如计数器从6开始而非0）\n- 测试顺序影响结果\n\n### 步骤2：定位全局状态\n使用工具：\n- `rg \"static.*[:A-Z]\" src/` 查找静态变量\n- `rg \"lazy.*Mutex\\|once_cell\" src/` 查找懒加载全局状态\n- `rg \"clear.*\\|reset.*\" src/` 查找现有清理函数\n\n### 步骤3：分析测试失败\n- 运行单个测试确认：`cargo test test_name -- --nocapture`\n- 运行全部测试确认：`cargo test -- --nocapture`\n- 记录失败模式：期望值vs实际值\n\n### 步骤4：设计清理策略\n- 查找或创建清理函数（通常命名为`clear_*()`或`reset_*()`）\n- 确保清理所有相关全局状态：\n  * 原子计数器：`COUNTER.store(0, Ordering::SeqCst)`\n  * Mutex集合：`MAP.lock().unwrap().clear()`\n  * Lazy静态变量：通过Mutex访问清理\n\n### 步骤5：实施修复\n1. 在现有清理函数中添加缺失的清理逻辑\n2. 若无清理函数，创建新的并添加`#[cfg(test)]`属性\n3. 在每个测试用例开头或`#[test]`函数中调用清理函数\n\n### 步骤6：验证修复\n- 运行单个测试验证：`cargo test specific_test`\n- 运行全部测试验证：`cargo test -- --nocapture`\n- 多次运行确保稳定性：`for i in {1..5}; do cargo test --quiet; done`\n\n## 注意事项\n- 清理函数应使用`#[cfg(test)]`避免污染生产代码\n- 清理顺序：先清理依赖少的，再清理依赖多的\n- 考虑线程安全：使用正确的Ordering和锁机制\n- 在测试模块的`#[test]`函数中统一调用清理函数\n\n## 可选步骤\n- 创建测试辅助宏统一处理清理\n- 添加测试间状态验证断言\n- 为复杂状态实现自定义Drop trait\n|||"
}