{
  "problem_type": "Rust临时文件持久化测试修复",
  "content": "问题重述：Rust中使用tempfile crate创建临时文件时，测试失败提示文件持久化错误（No such file or directory）。\n\n可复用解决流程：\n1. **问题诊断**\n   - 运行具体测试：`cargo test <测试路径> -- --nocapture`\n   - 检查错误信息：通常涉及临时文件在persist时被自动清理\n\n2. **核心修复**\n   - 检查临时文件创建方式，确保使用`keep()`方法保持文件存在\n   - 修改create_tmpfile函数：使用`NamedTempFile::keep()`替代`persist()`\n   - 确保文件路径格式符合预期（如/tmp/chibicc-前缀）\n\n3. **状态管理**\n   - 实现全局状态管理：使用`Lazy<Mutex<Vec<String>>>`跟踪所有临时文件\n   - 添加reset函数：在测试前后清理全局状态\n   - 实现自动清理：测试完成后删除创建的所有临时文件\n\n4. **验证修复**\n   - 运行特定测试确认通过\n   - 运行完整测试套件确保无回归\n   - 检查文件路径格式正确性\n\n注意事项：\n- 避免使用persist()，它会移动文件并可能导致路径问题\n- 使用keep()保持文件在原位置\n- 测试隔离是关键，防止状态污染\n- 处理可能的Mutex poisoned状态\n\n工具使用：\n- tempfile::NamedTempFile::with_prefix_in()：创建带前缀的临时文件\n- temp_file.keep()：保持文件存在并获取最终路径\n- 全局Lazy<Mutex<T>>：管理跨测试的状态"
}