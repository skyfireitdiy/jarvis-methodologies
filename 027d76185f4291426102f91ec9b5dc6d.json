{
  "problem_type": "C系统编程到Rust转译",
  "content": "# C系统编程到Rust转译方法论（FUSE/全局状态管理）\n\n## 问题重述\n将使用FUSE文件系统、全局变量、链表结构的C系统程序转译为Rust，要求通过TDD方法保持行为一致性。\n\n## 可复用解决流程\n\n### 阶段1：行为分析\n1. **读取完整C源码**：使用read_code获取完整上下文\n2. **识别系统调用**：找出FUSE API、文件操作、内存管理\n3. **分析全局状态**：记录所有全局变量和生命周期\n4. **绘制调用图**：理解函数依赖关系\n\n### 阶段2：测试设计（Red）\n1. **主要路径测试**：\n   - FUSE初始化和销毁\n   - 用户创建流程\n   - 消息发送处理\n   - 资源清理验证\n2. **边界测试**：\n   - 空指针处理\n   - 内存分配失败\n   - 系统调用错误\n3. **状态验证**：\n   - 全局变量变化\n   - 数据结构一致性\n\n### 阶段3：架构映射（Green）\n1. **全局状态转换**：\n   ```rust\n   // C: int Message = 100;\n   static mut MESSAGE: i32 = 100; // 简单类型\n   // 或使用RwLock包装复杂类型\n   ```\n2. **链表转集合**：\n   ```rust\n   // C: 链表结构 -> Rust: HashMap<UserId, User>\n   use std::collections::HashMap;\n   ```\n3. **FUSE包装**：\n   ```rust\n   // 用fuser库包装FUSE操作\n   use fuser::{FileSystem, mount2};\n   ```\n\n### 阶段4：实现策略\n1. **Stub优先**：创建空实现让测试通过\n2. **分层实现**：按依赖顺序实现函数\n3. **行为验证**：运行C程序对比输出\n4. **内存安全**：用RAII替换malloc/free\n\n### 阶段5：重构优化\n1. **错误处理**：Result类型替换错误码\n2. **并发安全**：RwLock替换全局变量\n3. **接口设计**：Rust风格API设计\n4. **性能优化**：使用迭代器、缓存等\n\n## 注意事项\n- 保持测试用例与C行为完全一致\n- 全局变量使用unsafe块访问，考虑线程安全\n- FUSE操作需要用Rust库重新实现，不能直接翻译\n- 内存管理用所有权系统替代手动释放\n- 测试状态隔离使用Once和Mutex\n\n## 可选步骤\n- 使用ctags分析符号依赖\n- 创建输出对比工具验证行为一致性\n- 添加性能基准测试\n- 实现跨平台特性支持"
}