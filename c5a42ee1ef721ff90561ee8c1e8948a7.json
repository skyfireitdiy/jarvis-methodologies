{
  "problem_type": "C到Rust函数迁移（TDD方式）",
  "content": "## C到Rust函数迁移的TDD方法论\n\n### 问题重述\n将C函数迁移到Rust实现，使用测试驱动开发（TDD）方法确保功能等价性和代码质量。\n\n### 可复用解决流程\n\n#### 1. 分析阶段（Red前准备）\n- 使用read_code读取目标Rust模块文件，了解现有代码结构\n- 分析C源码函数的签名、参数类型、返回值和错误处理逻辑\n- 确定C类型到Rust类型的对应关系（如int→i32，long long→i64）\n\n#### 2. Red阶段 - 编写测试\n- 在目标文件中添加#[cfg(test)] mod tests测试模块\n- 设计全面测试用例覆盖：\n  * 边界值测试（最小值、最大值、0、1等）\n  * 正常功能测试（典型输入）\n  * 异常输入测试（负数、无效值等）\n  * 错误处理测试（返回错误码的情况）\n- 确保测试可编译但会失败（函数未实现）\n\n#### 3. Green阶段 - 实现函数\n- 在测试模块前实现pub函数，遵循Rust命名规范\n- 严格按照C函数逻辑实现，保证语义等价\n- 使用Rust原生类型和惯用法：\n  * 适当使用类型转换（如i as i64）\n  * 避免extern \"C\"，使用标准Rust调用约定\n  * 使用RAII模式管理资源\n- 添加中文注释说明功能和参数\n\n#### 4. Refactor阶段 - 优化代码\n- 检查代码是否符合Rust惯用法\n- 优化可读性（变量命名、代码结构）\n- 避免不必要的性能优化，保持简单清晰\n\n#### 5. 验证阶段\n- 使用execute_script运行cargo test验证所有测试通过\n- 使用execute_script运行cargo check确保编译无警告\n- 验证与C函数的语义等价性\n\n### 工具使用组合\n- read_code: 读取现有文件内容\n- edit_file: 添加测试和实现代码\n- execute_script: 运行测试和编译检查\n\n### 注意事项\n- 禁止使用todo!/unimplemented!，必须实现完整功能\n- 注释使用中文，禁止use ...::*通配导入\n- 保持最小变更，避免无关重构\n- 错误值保持与C代码一致（如-1表示错误）\n- 资源释放类函数通过RAII自动管理\n\n### 可选步骤\n- 对于复杂函数，可以分步骤实现对应的测试\n- 如果有依赖函数，先实现底层依赖\n- 可以添加基准测试验证性能"
}