{
  "problem_type": "LittleFS移植项目代码模块迁移",
  "content": "## LittleFS移植项目：测试函数向模块级迁移方法论\n\n### 问题重述\n在C到Rust的LittleFS文件系统移植中，测试模块中的核心函数需要从测试作用域提升到模块级作用域，以便被主逻辑引用，同时保持功能一致性。\n\n### 可复用解决流程\n\n#### 1. 依赖分析阶段\n- **工具**：`lsp_client` + `read_code`\n- **操作**：使用`search_symbol`定位待迁移函数的所有引用\n- **验证**：确认函数在测试模块中的完整实现\n\n#### 2. 迁移执行阶段\n- **工具**：`edit_file` + `read_code`\n- **步骤**：\n  1. 从测试模块复制函数定义到模块级\n  2. 添加适当的`#[allow(dead_code)]`或`pub(crate)`标记\n  3. 更新所有调用点的引用路径\n  4. 删除测试模块中的重复实现（如有）\n\n#### 3. 边界条件修复\n- **工具**：`execute_script` + `cargo test`\n- **关注点**：\n  - 配置参数的默认值处理（如prog_size=0）\n  - 内存安全检查（边界值测试）\n  - 异常路径验证\n\n#### 4. 验证完成标准\n- ✅ 所有测试通过\n- ✅ 主逻辑无编译错误\n- ✅ 功能行为保持不变\n- ✅ 代码风格一致性\n\n### 注意事项\n1. **保持C源码意图**：避免过度重构，优先保持原算法结构\n2. **渐进式迁移**：单次只迁移一个函数链，避免大面积修改\n3. **测试驱动**：每次迁移后立即运行相关测试验证\n4. **边界防护**：对可能导致panic的运算添加边界检查\n\n### 可选步骤\n- 添加缺失的测试用例（如本任务中的`test_dir_commit_orphans_cleanup_success`）\n- 创建临时备份分支以便回滚\n- 添加迁移日志记录变更详情"
}