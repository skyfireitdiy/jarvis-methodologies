{
  "problem_type": "代码反向工程与文档生成",
  "content": "# 代码反向工程与文档生成方法论\n\n## 规则简介\n\n本方法论提供了一套系统化的代码反向工程和文档生成流程，用于从现有代码中提取设计信息，生成完整、规范、可维护的技术文档。适用于对已有系统进行架构分析、文档重构或知识转移的场景。\n\n## 你必须遵守的原则\n\n### 原则1：基于实际代码，禁止臆测\n\n**要求说明：**\n\n- **必须**：所有文档内容必须基于实际代码分析得出\n- **必须**：使用工具（rg、fd、read_code）精确定位和分析代码\n- **必须**：在文档中明确标注代码来源（目录、文件、行号）\n- **禁止**：凭空假设代码结构或功能\n- **禁止**：虚构不存在的接口或数据结构\n- **禁止**：在没有证据的情况下推断设计意图\n\n### 原则2：标准文档结构，确保完整性\n\n**要求说明：**\n\n- **必须**：生成总览文档（README.md），包含模块定位、职责、快速导航\n- **必须**：生成架构分析文档，包含层次结构、核心组件、数据流\n- **必须**：生成功能文档，详细说明每个功能的设计和实现\n- **必须**：生成分析文档（如依赖关系分析），说明模块间关系\n- **禁止**：只生成部分文档就认为任务完成\n- **禁止**：文档之间缺乏关联和引用\n\n### 原则3：图文结合，提高可读性\n\n**要求说明：**\n\n- **必须**：使用ASCII图形绘制架构图、流程图、数据流图\n- **必须**：使用表格组织配置参数、接口定义等信息\n- **必须**：使用代码块展示关键数据结构和接口定义\n- **必须**：使用Markdown格式（标题、列表、引用、粗体等）组织内容\n- **禁止**：纯文字描述，缺乏视觉辅助\n\n### 原则4：提供实用指导，增强可操作性\n\n**要求说明：**\n\n- **必须**：在文档中提供使用指南和示例代码\n- **必须**：说明配置参数的含义和建议值\n- **必须**：提供性能调优和故障排查建议\n- **禁止**：只描述\"是什么\"，不说明\"怎么用\"\n\n## 你必须执行的操作\n\n### 阶段1：代码收集和分析\n\n1. **定位目标代码**：\n   - 使用 `fd` 查找目标目录和文件\n   - 使用 `rg` 搜索关键函数、数据结构、接口定义\n   - 确定分析的边界（哪些文件属于目标模块）\n\n2. **读取和理解代码**：\n   - 使用 `read_code` 读取核心文件\n   - 识别关键数据结构、函数、接口\n   - 理解模块的职责和功能\n   - 分析依赖关系（依赖哪些模块、被哪些模块依赖）\n\n3. **提取关键信息**：\n   - 列出核心文件清单（源文件、头文件、测试文件）\n   - 识别关键代码位置（函数名、行号范围）\n   - 提取配置参数和功能开关\n   - 理解设计模式和架构风格\n\n### 阶段2：文档规划和设计\n\n1. **设计文档结构**：\n   - 确定需要生成的文档列表\n   - 设计文档的目录结构\n   - 规划文档之间的引用关系\n\n2. **标准文档清单**：\n   - README.md（模块总览）\n   - architecture_analysis.md（架构分析）\n   - 功能文档（如cpu_monitor.md、config_management.md）\n   - 分析文档（如dependency_analysis.md）\n\n### 阶段3：文档生成\n\n1. **生成总览文档（README.md）**：\n   - 文档概述和目录\n   - 模块概述（定位、职责、代码来源）\n   - 快速导航（按角色、按主题）\n   - 架构概览（架构图、核心组件、设计模式）\n   - 核心功能（功能列表、简要说明）\n   - 技术栈（语言、架构模式、依赖模块）\n   - 文档索引（所有文档的链接和说明）\n   - 使用指南（快速开始、配置建议、故障排查）\n\n2. **生成架构分析文档**：\n   - 架构概述（类型、理念、特点）\n   - 系统层次结构（层次图、职责说明）\n   - 核心组件设计（组件职责、数据结构、接口）\n   - 数据流设计（数据采集流程、处理流程）\n   - 接口设计（接口层次、分类、说明）\n   - 并发和同步（并发模型、同步机制）\n   - 性能优化（优化策略、内存优化）\n   - 可扩展性设计（扩展机制、设计模式）\n   - 错误处理（处理策略、错误码）\n   - 架构优势（优势分析、改进点）\n\n3. **生成功能文档**：\n   - 功能概述（职责、代码来源、关键代码位置）\n   - 架构设计（架构图、层次关系）\n   - 核心数据结构（结构定义、职责说明、代码位置）\n   - 功能设计（各子功能的详细设计、工作流程、日志格式）\n   - 接口设计（接口类型、参数说明、使用示例）\n   - 配置参数（参数表格、配置建议）\n   - 性能优化（性能策略、优化方法）\n   - 调试支持（调试接口、调试信息）\n\n4. **生成分析文档**：\n   - 分析概述（目的、范围）\n   - 模块依赖关系（依赖图、依赖层次）\n   - 接口依赖（依赖的接口、使用方式）\n   - 数据流依赖（数据流向、处理流程）\n   - 平台依赖（硬件、操作系统）\n   - 库依赖（标准库、第三方库）\n   - 依赖强度分析（强依赖、中等依赖、弱依赖）\n   - 循环依赖分析（潜在循环、解决方案）\n   - 优化建议（解耦建议、可移植性改进）\n\n### 阶段4：文档验证和完善\n\n1. **验证文档完整性**：\n   - 检查所有计划文档是否已生成\n   - 检查文档内容是否完整（是否包含所有必需章节）\n   - 检查文档之间的引用是否正确\n\n2. **验证内容准确性**：\n   - 检查代码来源信息是否准确\n   - 检查关键代码位置是否正确\n   - 检查数据结构和接口定义是否与代码一致\n\n3. **完善文档质量**：\n   - 检查格式是否规范（Markdown格式、图表、代码块）\n   - 检查是否有错别字或语法错误\n   - 检查示例代码是否可运行\n\n## 实践指导\n\n### 文档组织建议\n\n1. **目录结构**：\n   ```\n   .jarvis/rules/project_info/[模块名]/\n   ├── README.md              # 总览文档\n   ├── architecture_analysis.md  # 架构分析\n   ├── [功能1].md             # 功能文档\n   ├── [功能2].md             # 功能文档\n   └── [分析].md              # 分析文档\n   ```\n\n2. **文档命名**：\n   - 使用小写字母和下划线\n   - 名称应清晰反映文档内容\n   - 例如：cpu_monitor.md、config_management.md\n\n3. **文档引用**：\n   - 使用相对路径引用其他文档\n   - 格式：`[文档名称](document_name.md)`\n   - 在相关章节提供引用链接\n\n### 内容撰写建议\n\n1. **架构图绘制**：\n   - 使用ASCII字符绘制简单清晰的架构图\n   - 使用方框表示组件，箭头表示数据流或依赖\n   - 保持层次清晰，避免过于复杂\n\n2. **代码示例**：\n   - 提供完整的、可运行的代码示例\n   - 添加必要的注释说明\n   - 标注代码来源文件和行号\n\n3. **表格使用**：\n   - 使用表格组织配置参数、接口定义等结构化信息\n   - 表格应包含：名称、类型、默认值、说明等列\n   - 确保表格格式正确、对齐\n\n4. **章节层级**：\n   - 使用 # 表示文档标题\n   - 使用 ## 表示主要章节\n   - 使用 ### 表示子章节\n   - 避免层级过深（最多4级）\n\n### 常见错误\n\n1. **内容臆测**：\n   - 错误：根据经验推测代码功能\n   - 正确：基于实际代码分析得出结论\n\n2. **缺少代码来源**：\n   - 错误：只说\"核心函数在xxx文件\"\n   - 正确：明确标注\"代码位置：moni_cpulog.c:444-459\"\n\n3. **文档不完整**：\n   - 错误：只生成总览文档和部分功能文档\n   - 正确：生成完整的文档集，包括架构、功能、分析文档\n\n4. **格式混乱**：\n   - 错误：使用不规范的Markdown格式\n   - 正确：遵循标准Markdown格式，使用表格、代码块、引用等\n\n## 检查清单\n\n### 代码分析阶段\n\n- [ ] 已定位所有目标代码文件\n- [ ] 已读取并理解核心代码\n- [ ] 已识别关键数据结构和接口\n- [ ] 已分析模块依赖关系\n- [ ] 已提取所有配置参数\n- [ ] 已记录关键代码位置（文件名和行号）\n\n### 文档生成阶段\n\n- [ ] 已生成README.md总览文档\n- [ ] 已生成architecture_analysis.md架构分析文档\n- [ ] 已生成所有功能文档\n- [ ] 已生成所有分析文档\n- [ ] 所有文档包含完整的章节结构\n- [ ] 所有文档包含代码来源信息\n- [ ] 所有文档包含架构图或流程图\n- [ ] 所有文档包含使用指南或示例\n\n### 文档验证阶段\n\n- [ ] 所有文档格式正确（Markdown格式）\n- [ ] 所有文档之间的引用正确\n- [ ] 所有代码示例准确无误\n- [ ] 所有表格格式规范\n- [ ] 所有图表清晰可读\n- [ ] 文档内容完整，没有遗漏\n- [ ] 文档内容准确，与代码一致",
  "scope": "global"
}