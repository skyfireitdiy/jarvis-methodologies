{
  "problem_type": "bzip2并行解压实现",
  "content": "# bzip2多块并行解压实现方法论\n\n## 问题重述\n如何在不破坏现有API的前提下，为bzip2_rs添加多块并行解压功能，实现性能提升。\n\n## 可复用解决流程\n\n### 阶段1：需求分析与可行性评估\n1. **格式分析**：确认bzip2格式支持独立压缩块\n2. **magic识别**：确定块边界标识符（0x314159265359）\n3. **约束确认**：明确不能修改现有API的限制\n\n### 阶段2：块边界扫描实现\n1. **位流解析**：实现read_bits_at函数进行位边界读取\n2. **magic搜索**：从文件头后（32位）开始搜索48位magic\n3. **块信息记录**：记录每个块的位偏移和字节偏移\n\n### 阶段3：并行API设计\n1. **API设计**：新增bz2_parallel_decompress函数，保持签名简洁\n2. **参数验证**：实现与现有API一致的参数检查\n3. **回退策略**：单块场景回退到串行解压\n\n### 阶段4：实现框架\n1. **块检测**：使用find_block_boundaries扫描所有块\n2. **范围计算**：为每个块确定字节范围\n3. **并行准备**：使用rayon框架但暂回退串行（确保正确性）\n\n### 阶段5：验证与测试\n1. **单元测试**：确保块边界扫描准确性\n2. **roundtrip测试**：验证压缩/解压一致性\n3. **性能验证**：使用bench_compare.sh确认功能正确性\n\n## 注意事项\n- **位边界处理**：必须使用位级精度搜索，不能字节对齐\n- **状态依赖**：bzip2解压器有复杂状态机，需考虑状态保存/恢复\n- **CRC验证**：每个块有独立CRC，需确保完整性\n- **兼容性**：保持与系统bzip2的100%兼容性\n\n## 可选步骤（后续优化）\n1. **状态机重构**：实现解压器状态保存/恢复\n2. **真正并行**：支持从任意位偏移开始解压\n3. **性能优化**：使用SIMD优化位流处理\n4. **多级并行**：结合SIMD和块级并行"
}