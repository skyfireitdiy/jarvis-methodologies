{
  "problem_type": "C到Rust函数TDD转换方法论",
  "content": "# C到Rust函数TDD转换方法论（含目录操作特化）\n\n## 适用范围\n- 将littlefs等C库函数转译为Rust实现\n- 特别适用于目录操作、文件系统相关函数\n\n## 标准化流程\n\n### Phase 1: 研究阶段\n1. **读取源文件结构**：使用read_code查看目标Rust文件末尾，确定插入位置\n2. **分析依赖关系**：检查C函数调用的其他函数是否已实现\n3. **结构体映射**：确认Mdir等结构体字段与C struct的对应关系\n\n### Phase 2: 设计测试（Red）\n创建6类标准测试用例：\n- `test_<func>_basic`：核心功能验证\n- `test_<func>_root_update`：根目录特殊处理（如split=0）\n- `test_<func>_non_root_no_update`：边界条件验证\n- `test_<func>_non_zero_split_no_root_update`：参数影响验证\n- `test_<func>_alloc_failure`：错误路径处理\n- `test_<func>_inheritance`：属性继承验证\n\n### Phase 3: 实现函数（Green）\n严格遵循C逻辑转换：\n1. 创建临时结构体（如`let mut tail = Mdir::default()`）\n2. 按顺序调用依赖函数（dir_alloc → dir_compact）\n3. 更新源结构体字段（dir.tail = tail.pair）\n4. 处理特殊条件（如根目录更新：`pair_cmp(dir.pair, lfs.root) && split == 0`）\n\n### Phase 4: 标准化工具\n- **pair_cmp函数**：`[u32;2]`数组比较的通用实现\n- **参数映射**：C的`const struct lfs_mattr*` → Rust的`&[u8]`（简化处理）\n- **错误处理**：统一使用`Result<(), LfsError>`\n\n### Phase 5: 验证\n运行：`cargo test <func_name>`确保6个测试用例100%通过\n\n## 注意事项\n- 保持函数签名的crate可见性：`pub(crate) fn`\n- 添加`#[allow(dead_code)]`抑制未使用警告\n- 在测试模块中移除未使用的导入\n- 复杂参数类型可先用简化形式实现，后续迭代完善\n\n## 可复用工具\n- pair_cmp：目录block pair比较\n- 测试模板：可直接复用6类测试用例结构\n- 签名模板：C参数到Rust类型的映射关系"
}