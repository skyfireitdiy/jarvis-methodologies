{
  "problem_type": "模块反向工程分析",
  "content": "# 模块反向工程分析\n\n## 规则简介\n\n本方法论提供了一套系统化的流程，用于对代码模块进行反向工程分析，提取设计信息并生成语言无关的设计方案文档。适用于任何编程语言的模块级代码分析。\n\n## 你必须遵守的原则\n\n### 原则1：全面覆盖\n\n**要求说明：**\n\n- **必须**：覆盖模块的所有子模块和核心组件\n- **必须**：记录所有代码来源（目录和文件列表）\n- **必须**：生成功能对照表验证完整性\n- **禁止**：遗漏关键模块或虚构代码功能\n\n### 原则2：语言无关设计\n\n**要求说明：**\n\n- **必须**：生成语言无关的设计方案，避免特定语言细节\n- **必须**：关注架构设计、职责划分、依赖关系等通用概念\n- **禁止**：过度依赖特定语言特性进行描述\n\n### 原则3：结构化文档\n\n**要求说明：**\n\n- **必须**：按照标准结构生成文档（职责、结构、组件、依赖、代码来源）\n- **必须**：使用清晰的标题层级和表格格式\n- **禁止**：文档结构混乱或信息不完整\n\n## 你必须执行的操作\n\n### 阶段1：信息收集\n\n1. **步骤1：分析模块目录结构**\n   - 使用 find 或 fd 命令获取模块的完整文件列表\n   - 识别所有子模块、测试文件和配置文件\n   - 记录文件数量和代码行数\n\n2. **步骤2：读取模块主文件**\n   - 读取模块的 mod.rs 或主入口文件\n   - 了解模块的组织方式和子模块声明\n   - 识别 feature 标识和条件编译\n\n3. **步骤3：读取子模块代码**\n   - 按照依赖顺序读取各个子模块的源代码\n   - 关注核心函数、结构体、trait 的定义和实现\n   - 记录公共接口和私有实现\n\n4. **步骤4：分析外部依赖**\n   - 检查 Cargo.toml 或依赖配置文件\n   - 识别外部库及其用途\n   - 记录版本和 feature 配置\n\n### 阶段2：结构分析\n\n1. **步骤1：识别模块职责**\n   - 总结模块的核心功能和目的\n   - 识别模块提供的服务和能力\n   - 明确模块的业务价值\n\n2. **步骤2：绘制模块结构**\n   - 构建目录结构树\n   - 说明每个子模块的职责\n   - 识别模块间的依赖关系\n\n3. **步骤3：提取核心组件**\n   - 列出所有主要结构体、trait、函数\n   - 说明每个组件的职责和代码位置\n   - 按子模块分组组织\n\n### 阶段3：关系分析\n\n1. **步骤1：绘制外部依赖图**\n   - 识别所有外部依赖库\n   - 说明每个依赖的用途\n   - 标记 feature 控制的依赖\n\n2. **步骤2：绘制内部依赖关系**\n   - 分析子模块之间的调用关系\n   - 识别循环依赖（如果存在）\n   - 说明依赖方向和原因\n\n3. **步骤3：生成功能对照表**\n   - 列出所有功能需求\n   - 标注每个功能的实现位置\n   - 验证功能的完整性\n\n### 阶段4：文档生成\n\n1. **步骤1：创建文档目录**\n   - 在 .jarvis/rules/project_info/ 下创建对应模块目录\n   - 确保目录结构与项目结构一致\n\n2. **步骤2：生成模块文档**\n   - 按照标准结构编写文档内容\n   - 包含：模块职责、结构说明、核心组件、依赖关系、代码来源\n   - 添加设计要点、使用示例、注意事项等补充信息\n\n3. **步骤3：验证文档完整性**\n   - 检查是否覆盖所有子模块\n   - 验证功能对照表的完整性\n   - 确认代码来源记录准确\n\n## 实践指导\n\n### 最佳实践\n\n1. **从小到大**：先理解主文件，再深入子模块，避免被细节淹没\n2. **关注接口**：优先理解公共接口和 API，再了解内部实现\n3. **记录位置**：每个设计决策都要记录对应的代码位置，便于追溯\n4. **标注不确定**：对于不确定的部分，在文档中明确标注，待后续分析\n\n### 常见错误\n\n1. **过度深入**：陷入实现细节，忽视架构层面的理解\n2. **遗漏测试**：忽略测试文件中的使用示例和边界情况\n3. **虚构功能**：基于假设而非代码实际内容推断功能\n4. **结构混乱**：文档组织不清晰，信息分散难以查找\n\n## 检查清单\n\n- [ ] 模块职责描述清晰准确\n- [ ] 子模块结构完整无遗漏\n- [ ] 核心组件列表包含所有主要类型\n- [ ] 依赖关系图准确反映实际依赖\n- [ ] 代码来源记录包含所有文件\n- [ ] 功能对照表覆盖所有功能点\n- [ ] 文档格式符合规范要求\n- [ ] 标注了不确定或待分析的部分",
  "scope": "global"
}