{
  "problem_type": "Rust项目测试执行优化",
  "content": "# Rust项目测试执行优化方法论\n\n## 问题重述\n在大型Rust项目中，完整的测试套件可能耗时极长，导致：\n1. 测试执行超时（超过300秒）\n2. 无法快速验证单个模块的测试修改\n3. 覆盖率测试同样耗时，影响开发效率\n4. 条件编译代码可能影响测试覆盖\n\n## 可复用解决流程\n\n### 步骤1：精确定位测试模块\n- 使用cargo测试过滤功能，只运行相关模块的测试\n- 过滤方式：\n```bash\n  # 运行特定测试文件中的所有测试\n  cargo test --package <crate_name> <module_path>\n \n  # 示例：只运行comm::tests模块的测试\n  cargo test --package idf comm::tests\n```\n\n### 步骤2：使用测试名称过滤\n- 直接运行单个或多个特定测试\n- 过滤方式：\n```bash\n  # 运行单个测试\n  cargo test --package <crate_name> <test_name>\n \n  # 示例：运行test_bind_unbind测试\n  cargo test --package idf test_bind_unbind\n```\n\n### 步骤3：控制测试并行性\n- 使用`--test-threads`参数控制并发测试数量\n- 调整方式：\n```bash\n  # 单线程运行（避免资源竞争和超时）\n  cargo test --package <crate_name> -- --test-threads=1\n \n  # 限制并发数\n  cargo test --package <crate_name> -- --test-threads=4\n```\n\n### 步骤4：条件编译测试策略\n- 对于`#[cfg(target_arch = \"...\")]`标记的测试：\n  - 确认当前平台架构\n  - 使用`rustc --print cfg`查看平台信息\n  - 如果测试不在当前平台编译，使用`--target`交叉编译或跳过\n\n### 步骤5：覆盖率测试优化\n- 使用`cargo llvm-cov`的过滤功能\n- 优化方式：\n```bash\n  # 只测试特定包\n  cargo llvm-cov test --package <crate_name>\n \n  # 使用正则表达式过滤文件\n  cargo llvm-cov test --ignore-filename-regex <pattern>\n \n  # 示例：只查看msg_queue的覆盖率\n  cargo llvm-cov test --package idf --ignore-filename-regex 'demo|vendor|benchmark|manual_test' | grep 'msg_queue'\n```\n\n### 步骤6：快速编译检查\n- 在运行测试前先检查编译是否成功\n- 方式：\n```bash\n  # 只编译不运行（快速发现语法错误）\n  cargo test --package <crate_name> --no-run\n```\n\n## 注意事项\n\n### 项目结构理解\n- 理解crate结构：workspace中的多个包需要指定`--package <crate_name>`\n- 测试模块位置：通常在`src/<module>/tests/`或项目根目录的`tests/`\n- mod.rs引用：确保测试模块被正确引入到crate的测试模块中\n\n### 条件编译限制\n- 某些测试使用`#[cfg(target_arch = \"x86\")]`或类似条件\n- 这些测试只在特定平台编译和运行\n- 其他架构平台会自动跳过这些测试\n\n### Trait导入\n- 调用trait方法（如`as_fd()`）需要显式导入trait\n- 常见：`use std::os::fd::{AsFd, AsRawFd}`\n\n### 测试命名约定\n- 测试函数名通常以`test_`开头\n- 使用`#[test]`或`#[rstest]`属性标记\n- 参数化测试使用`#[rstest]`和`#[case]`\n\n### Git提交策略\n- 使用checkpoint方式提交：小步提交，便于回滚\n- 提交信息格式：`CheckPoint #<number>`\n- 每个checkpoint应可独立编译和测试\n\n## 可选步骤\n\n### 使用nextest加速测试\n```bash\n# 安装nextest\ncargo install nextest\n\n# 使用nextest运行测试（比cargo test更快）\ncargo nextest run --package <crate_name>\n```\n\n### 使用cargo-llvm-cov的HTML报告\n```bash\n# 生成HTML覆盖率报告，便于可视化查看\ncargo llvm-cov test --package <crate_name> --html --open\n```\n\n### 并行测试多个独立模块\n```bash\n# 使用tmux或并行命令同时测试多个模块\ntmux new -d -s test_session\ntmux send-keys -t test_session \"cargo test --package idf module_a\" C-m\ntmux send-keys -t test_session \"cargo test --package idf module_b\" C-m\n```\n\n## 验证标准\n- 测试编译成功且无warning\n- 测试运行无超时\n- 覆盖率报告正确显示目标文件\n- 目标文件的line和region覆盖率达到要求",
  "scope": "global"
}