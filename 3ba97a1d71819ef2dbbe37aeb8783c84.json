{
  "problem_type": "为C转译函数添加单元测试的方法论",
  "content": "# C转译函数单元测试添加方法论\n\n## 问题重述\n将C代码转译为Rust后，需要为转译后的Rust函数添加单元测试，确保功能与原始C实现一致。\n\n## 可复用解决流程\n\n### 阶段1：分析原始C行为\n1. 使用 read_code 读取原始C函数实现\n2. 识别关键行为模式：输入输出关系、边界条件、错误处理\n3. 记录C函数的测试场景（正常路径、边界情况、异常路径）\n\n### 阶段2：设计测试用例\n1. 正常路径测试：验证基本功能正确性\n2. 边界条件测试：空值、极值、特殊格式\n3. 路径相关测试：绝对路径、相对路径、根目录、无父目录\n4. 状态验证：检查副作用（如修改的集合、全局状态）\n\n### 阶段3：实现测试代码\n1. 在目标文件末尾添加 `#[cfg(test)] mod tests`\n2. 使用标准断言：`assert!`, `assert_eq!`, `assert_ne!`\n3. 为每个测试用例提供清晰的命名和注释\n4. 验证所有可观察的行为（返回值、参数修改、副作用）\n\n### 阶段4：验证与调试\n1. 运行 `cargo test -- --nocapture`\n2. 对于失败的测试：\n   - 检查测试预期是否正确（是否准确反映C行为）\n   - 检查实现是否存在偏差\n   - 调整测试或修复实现\n3. 确保所有测试通过后提交\n\n### 注意事项\n- 注意空路径/空字符串的边界行为差异\n- 路径处理要注意跨平台差异\n- 内存分配和错误处理行为可能与C不同\n- 测试用例应独立于具体实现，基于原始C规范\n\n### 可选步骤\n- 添加性能基准测试（如适用）\n- 添加集成测试验证端到端行为\n- 使用 property-based testing 验证更多随机输入"
}