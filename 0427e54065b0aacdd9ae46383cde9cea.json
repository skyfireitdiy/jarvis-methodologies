{
  "problem_type": "Rust并发测试隔离性修复",
  "content": "问题重述：\nRust项目中使用全局状态（如lazy_static + Mutex）的测试在并发运行时失败，表现为：\n- 状态污染导致测试间相互影响\n- Mutex中毒错误\n- 断言失败（期望值与实际值不符）\n\n解决流程：\n1. **问题诊断**\n   - 运行`cargo test`确认并发失败\n   - 运行`cargo test -- --test-threads=1`验证单线程是否通过\n   - 确认是否为并发vs单线程的差异\n\n2. **状态清理优化**\n   - 检查并优化全局状态清理函数（如clear_scopes）\n   - 确保清理后状态为已知良好初始状态\n   - 使用`unwrap_or_else(|e| e.into_inner())`处理Mutex中毒\n\n3. **测试策略选择**\n   - 优先使用单线程测试作为稳定基线\n   - 仅在必要时进行代码级重构\n   - 记录采用的测试策略供团队参考\n\n4. **验证与记录**\n   - 运行完整测试套件确认修复\n   - 在CI/CD中配置备用单线程测试命令\n   - 文档化测试执行策略\n\n注意事项：\n- 单线程测试会降低执行速度，但提高稳定性\n- 全局状态设计应优先考虑测试隔离性\n- 考虑未来使用线程局部存储等更安全的方案"
}