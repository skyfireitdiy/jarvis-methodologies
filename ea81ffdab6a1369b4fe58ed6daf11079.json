{
  "problem_type": "Rust测试失败诊断",
  "content": "## Rust测试失败诊断通用方法论\n\n### 问题重述\n当Rust测试失败（如断言失败、panic、返回错误值等）时，需要系统性诊断根本原因并制定修复方案。\n\n### 可复用解决流程\n\n#### 步骤1：重现和定位\n- 使用`cargo test test_name -- --nocapture`单独运行失败测试\n- 观察错误类型：断言失败、panic、返回错误值\n- 记录测试名称和失败模式\n\n#### 步骤2：测试逻辑分析\n- 使用`read_code`读取测试函数实现\n- 理解测试的预期行为和断言条件\n- 识别测试涉及的外部依赖和全局状态\n\n#### 步骤3：代码实现验证\n- 检查被测试函数的实现逻辑\n- 验证边界条件和异常处理\n- 特别关注全局状态管理（static变量、Mutex等）\n\n#### 步骤4：隔离性问题检查\n- 检查测试是否调用了cleanup/reset函数\n- 验证全局状态清理是否完整（如clear_scopes、clear_typedefs等）\n- 运行`cargo test --test test_name`验证测试独立性\n\n#### 步骤5：修复和验证\n- 如果是实现错误：修复被测试代码\n- 如果是测试隔离性问题：完善清理函数或测试设置\n- 运行`cargo test`确保所有测试通过\n- 验证修复不影响其他测试\n\n### 关键注意事项\n1. **测试隔离性优先**：全局状态污染是最常见的测试失败原因\n2. **最小化修复**：优先修复清理函数而非改动业务逻辑\n3. **回归测试**：修复后必须运行完整测试套件\n4. **文档记录**：在清理函数中添加注释说明清理范围\n\n### 可选工具\n- `execute_script`: 运行cargo test相关命令\n- `read_code`: 查看测试和实现代码\n- `rg`: 搜索相关代码模式\n- `git log`: 查看历史修复记录"
}