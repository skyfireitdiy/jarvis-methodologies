{
  "problem_type": "修复Rust unsafe代码中的空指针/边界问题",
  "content": "# 修复Rust unsafe代码中指针边界问题的方法论\n\n## 问题重述\n在使用原始指针和unsafe代码的Rust项目中，空指针或无效指针导致的运行时错误，如`slice::from_raw_parts`的空指针panic。\n\n## 可复用解决流程\n\n### 1. 问题识别阶段\n- **症状识别**：SIGABRT、panic或内存分配异常\n- **错误定位**：使用`cargo test -- --nocapture`获取完整错误信息\n- **符号追踪**：通过`lsp_client.references`查找问题函数的调用链\n\n### 2. 边界条件分析\n- **空指针检查**：所有`from_raw_parts`调用前必须验证指针非空\n- **长度验证**：slice长度必须大于0且合理\n- **类型检查**：确保指针类型与预期用途匹配\n\n### 3. 修复实施\n- **最小修改**：仅修改必要的边界检查逻辑\n- **空值处理**：为特殊值（如空字符串、空键）提供单独处理分支\n- **保持接口**：不修改函数签名，仅调整内部实现\n\n### 4. 验证策略\n- **单元测试**：针对边界条件编写/修复测试用例\n- **回归测试**：确保修复不破坏现有功能\n- **内存检查**：使用`valgrind`或`sanitizer`检查内存问题\n\n## 注意事项\n1. **unsafe块最小化**：尽可能减少unsafe代码范围\n2. **文档更新**：在函数文档中明确说明边界条件行为\n3. **测试覆盖**：特别要测试空值、最大值、边界值情况\n4. **性能考虑**：边界检查不应引入显著性能开销\n\n## 工具组合使用\n- `lsp_client.references`：追踪函数调用链\n- `read_code`：分析代码上下文\n- `edit_file_structed`：精确修改关键代码块\n- `execute_script`：运行测试验证修复"
}