{
  "problem_type": "C到Rust函数移植修复",
  "content": "# C到Rust函数移植修复方法论\n\n## 问题重述\n在C到Rust代码移植过程中，需要确保移植后的函数与原始C函数在功能、行为和边界条件上保持一致，同时要解决审查中发现的各种问题如整数溢出、缺失依赖函数、错误处理不当等。\n\n## 可复用解决流程\n\n### 阶段1：问题识别与分析\n1. **原始C代码获取**\n   - 使用read_code读取C源码\n   - 使用read_symbols获取相关符号信息\n   - 确认C函数签名和行为\n\n2. **Rust实现现状分析**\n   - 使用lsp_client搜索符号定义\n   - 使用read_code查看当前Rust实现\n   - 识别缺失的依赖函数\n\n3. **差异分析**\n   - 参数列表对比\n   - 关键算法逻辑对比\n   - 边界条件处理对比\n   - 错误处理机制对比\n\n### 阶段2：缺失依赖实现\n1. **依赖函数识别**\n   - 遍历函数调用链\n   - 检查所有被调函数是否实现\n   - 优先实现无依赖的底层函数\n\n2. **等价功能实现**\n   - 遵循Rust所有权和借用规则\n   - 保持与C函数行为一致\n   - 避免使用unsafe代码\n\n### 阶段3：关键问题修复\n1. **整数溢出修复**\n   - 替换saturating_add为checked_add\n   - 添加边界检查\n   - 确保所有算术运算安全\n\n2. **逻辑一致性修复**\n   - 实现缺失的遍历/计算函数\n   - 修复条件判断逻辑\n   - 补充异常处理路径\n\n### 阶段4：测试验证\n1. **基础功能测试**\n   - 运行cargo test验证基本功能\n   - 检查回归测试\n\n2. **边界条件测试**\n   - 添加边界值测试用例\n   - 添加错误路径测试\n   - 验证异常处理\n\n3. **集成测试**\n   - 验证与其他模块的交互\n   - 检查整体系统行为\n\n## 注意事项\n- 保持最小改动原则，避免大范围重构\n- 每次修改后运行测试确保不引入回归\n- 优先修复严重问题（可能导致功能错误）\n- 中文注释，符合项目代码风格\n- 禁止引入新的第三方依赖\n\n## 可选步骤\n- 性能基准测试（如有要求）\n- 内存安全检查（使用MIRI等工具）\n- 文档更新（如API变更）"
}