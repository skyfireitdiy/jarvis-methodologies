{
  "problem_type": "C到Rust系统函数移植",
  "content": "## 方法论：C到Rust系统函数移植TDD\n\n### 适用场景\n将C语言系统函数（特别是编译器/解释器相关）移植到Rust，要求行为严格等价。\n\n### 核心流程\n1. **行为分析阶段**\n   - 使用read_code读取原始C实现\n   - 标注关键行为：输入输出、错误处理、副作用\n   - 创建行为规格表（用例→期望结果）\n\n2. **测试先行阶段**\n   - 先实现测试模块（`#[cfg(test)] mod tests`）\n   - 设计测试用例：正常路径、边界值、错误路径、副作用验证\n   - 创建测试辅助函数（如`create_test_token`）\n\n3. **最小实现阶段**\n   - 编写能通过编译的骨架实现（允许使用`todo!()`）\n   - 优先解决类型系统冲突（如`Result`→`Box`转换）\n\n4. **红绿循环阶段**\n   - 运行`cargo test <模块名>`专注当前函数\n   - 每次修复一个测试失败\n   - 关键修复模式：\n     - 类型不匹配：使用match+early return\n     - 错误处理：保持panic行为（移植初期）\n     - 内存管理：显式Box化返回值\n\n5. **行为验证阶段**\n   - 通过全部测试后，验证C/Rust行为一致性\n   - 清理`todo!()`和未使用的代码\n   - 添加必要的#[allow(dead_code)]标记\n\n### 关键模式\n- **类型转换表**：建立C类型到Rust类型的映射\n- **内存管理**：C指针→Box/Rc/Arc的转换策略\n- **错误处理**：C errno→Rust panic的映射\n\n### 注意事项\n- 保持panic信息格式与C版本一致（便于调试）\n- 首次移植优先功能正确，性能优化可后续进行\n- 保留C注释作为移植依据，添加Rust特有的文档注释"
}