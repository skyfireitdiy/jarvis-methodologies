{
  "problem_type": "Rust-C函数移植TDD方法",
  "content": "## 问题重述\n将C语言函数移植到Rust，同时保持语义等价，使用TDD方法确保质量。\n\n## 可复用解决流程\n\n### 阶段1：RESEARCH - 理解与分析\n1. **C代码分析**：\n   - 使用lsp_client定位目标函数\n   - 分析函数签名、依赖关系、副作用\n   - 识别关键数据结构和算法\n\n2. **依赖映射**：\n   - 列出所有C依赖函数\n   - 分类为：直接映射、需重构、需桩实现\n   - 评估Rust标准库替代方案\n\n### 阶段2：RED - 定义接口\n1. **创建Rust函数骨架**：\n   - 转换C签名到Rust签名（指针→引用，返回值→Result）\n   - 创建必要的struct定义\n   - 添加编译通过的stub实现\n\n2. **构建测试框架**：\n   - 创建可编译的最小项目\n   - 确保依赖stub存在\n\n### 阶段3：GREEN - 实现功能\n1. **逐行移植**：\n   - 保持C逻辑结构不变\n   - 将指针操作转换为安全Rust代码\n   - 处理边界条件（null检查、溢出等）\n\n2. **依赖实现**：\n   - 优先实现关键依赖（影响主逻辑的）\n   - 非关键依赖可用stub（如性能优化相关的）\n   - 保持API兼容性\n\n### 阶段4：验证与清理\n1. **构建验证**：\n   - cargo check确保无编译错误\n   - 修复所有警告（unused变量、mut等）\n\n2. **质量保证**：\n   - 代码风格检查\n   - 内存安全检查\n   - 行为一致性验证\n\n## 注意事项\n- 避免过早优化，先实现功能正确性\n- 保留C代码注释用于对照验证\n- 使用_前缀处理暂时未使用的变量\n- 定期git提交，便于回退\n\n## 可选步骤\n- 添加单元测试验证边界条件\n- 性能基准测试与C版本对比\n- 文档化移植决策和差异点"
}