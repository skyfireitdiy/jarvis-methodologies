{
  "problem_type": "功能移除",
  "content": "# 功能移除方法论\n\n## 规则简介\n\n用于从代码库中完全移除不再需要的功能或模块，确保没有残留的代码、引用和文档。\n\n## 你必须遵守的原则\n\n### 原则1：完全移除原则\n\n**要求说明：**\n\n- **必须**：删除所有源代码文件和目录\n- **必须**：清理所有 import 引用\n- **必须**：删除相关测试文件\n- **必须**：清理文档中的相关内容\n- **禁止**：留下\"僵尸代码\"或注释掉的代码\n- **禁止**：保留\"以防万一\"的备用代码\n\n### 原则2：依赖追溯原则\n\n**要求说明：**\n\n- **必须**：先分析被移除功能的依赖关系\n- **必须**：识别所有引用该功能的代码\n- **必须**：处理级联删除或适配\n- **禁止**：假设某个文件可以被删除而不验证\n\n### 原则3：小步提交原则\n\n**要求说明：**\n\n- **必须**：每次只删除一小部分代码\n- **必须**：每次删除后立即提交\n- **必须**：确保项目可以正常运行\n- **禁止**：一次性删除大量文件和代码\n- **禁止**：删除后不验证就继续\n\n## 你必须执行的操作\n\n### 阶段1：准备阶段\n\n1. **分析依赖关系**：搜索目标模块的所有引用（rg、grep），识别直接依赖和间接依赖，记录需要修改的文件列表\n\n2. **制定删除计划**：列出要删除的文件和目录，列出要清理的 import 语句，列出要简化的方法或类，确定删除顺序（先叶子后根节点）\n\n3. **创建回退点**：确认当前 git commit，记录回退命令\n\n### 阶段2：执行删除\n\n1. **删除源代码文件**：删除模块目录（rm -rf），删除独立文件\n\n2. **清理 import 引用**：删除 TYPE_CHECKING 中的导入，删除运行时导入，删除未使用的导入\n\n3. **删除属性和方法**：删除相关属性定义，删除初始化代码，简化方法（如果方法是公共 API，保留签名但简化实现），删除方法调用\n\n4. **清理测试文件**：删除相关测试目录和文件，清理测试配置\n\n5. **清理文档**：删除或更新相关文档，更新 API 文档\n\n### 阶段3：验证阶段\n\n1. **静态检查**：运行 ruff 检查，运行 mypy 类型检查，修复所有错误\n\n2. **搜索残留引用**：搜索关键词（模块名、类名、方法名），确认没有残留引用\n\n3. **功能测试**：运行项目主流程，验证没有报错，确认其他功能正常\n\n## 实践指导\n\n### 删除策略\n\n**优先级顺序：**\n1. 先删除测试文件（不影响主代码）\n2. 再删除实现代码\n3. 最后清理引用和导入\n\n**方法简化策略：**\n- 如果方法是公共 API，保留方法签名但简化实现\n- 示例：`def process(self, data): return data` 直接返回\n- 如果方法是内部方法，可以直接删除\n\n### 常见陷阱\n\n1. **循环依赖**：模块 A 依赖模块 B，模块 B 也引用模块 A。解决：同时删除两个模块，或先解除循环依赖\n\n2. **动态引用**：通过字符串导入或动态加载。解决：搜索所有可能的引用方式\n\n3. **配置文件**：配置中启用了被删除的功能。解决：清理或注释相关配置\n\n### 回退策略\n\n如果删除后出现问题：\n```bash\n# 回滚到最后一个工作点\ngit reset --hard <commit_id>\n\n# 或回滚特定文件\ngit checkout <commit_id> -- <file_path>\n```\n\n## 检查清单\n\n完成功能移除后，确认以下项目：\n\n### 代码清理\n- [ ] 所有源代码目录已删除\n- [ ] 所有源代码文件已删除\n- [ ] TYPE_CHECKING 导入已清理\n- [ ] 运行时导入已清理\n- [ ] 未使用的导入已清理\n- [ ] 属性定义已删除\n- [ ] 方法实现已简化或删除\n- [ ] 方法调用已删除\n\n### 测试清理\n- [ ] 相关测试目录已删除\n- [ ] 相关测试文件已删除\n- [ ] 测试配置已更新\n\n### 文档清理\n- [ ] 相关文档已删除或更新\n- [ ] API 文档已更新\n- [ ] README 已更新\n\n### 验证通过\n- [ ] ruff 静态检查通过\n- [ ] mypy 类型检查通过\n- [ ] 没有残留的引用（通过关键词搜索确认）\n- [ ] 项目可以正常启动\n- [ ] 主功能运行正常\n- [ ] 没有运行时错误或警告",
  "scope": "global"
}