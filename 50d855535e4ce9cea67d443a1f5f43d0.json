{
  "problem_type": "安装脚本设计-支持多种安装方式",
  "content": "# 安装脚本设计：支持多种安装方式\n\n## 问题重述\n当设计 Python 项目的安装脚本时，需要满足不同用户的需求：\n- 快速使用者：希望快速安装，无需下载源码\n- 开发者：需要查看和修改源码\n- 网络环境差异：需要支持多个镜像源（如 Gitee/GitHub）\n\n## 可复用解决流程\n\n### 1. 提供安装方式选择\n在脚本中添加用户交互，让用户选择安装方式：\n   ```bash\necho \"请选择安装方式：\"\necho \"  1) 直接安装（推荐） - 快速简单，无需下载源码，适合快速使用\"\necho \"  2) 克隆安装 - 下载源码到本地，便于查看和修改代码\"\nread -r -p \"请输入选择 [1/2，默认1]: \" choice\nINSTALL_TYPE=\"direct\"\ncase \"$choice\" in\n  2 )\n    INSTALL_TYPE=\"clone\"\n    ;;\n  * )\n    ;;\nesac\n   ```\n\n### 2. 实现直接安装（uv tool install from git）\n使用 `uv tool install git+URL` 直接从 git 仓库安装：\n   ```bash\ncase \"$INSTALL_TYPE\" in\n  direct )\n    # 支持带额外依赖的安装，如 RAG 功能\n    if [ \"$INSTALL_RAG\" = \"yes\" ]; then\n      uv tool install \"git+$GITEE_URL[rag]\"\n  else\n      uv tool install \"git+$GITEE_URL\"\nfi\n    ;;\nesac\n   ```\n\n### 3. 实现镜像源降级策略\n优先使用国内镜像，失败后自动回退：\n   ```bash\nset +e  # 允许失败以实现降级\nif uv tool install \"git+$GITEE_URL\"; then\n  echo \"✓ 从 Gitee 安装成功\"\n  else\n  echo \"✗ Gitee 安装失败，尝试从 GitHub 安装...\"\n  if uv tool install \"git+$GITHUB_URL\"; then\n    echo \"✓ 从 GitHub 安装成功\"\n  else\n    echo \"✗ GitHub 安装也失败，请检查网络连接\"\n    exit 1\nfi\nfi\nset -e\n   ```\n\n### 4. 保留克隆安装方式\n对于需要源码的用户，保持克隆逻辑：\n   ```bash\ncase \"$INSTALL_TYPE\" in\n  clone )\n    git clone \"$REPO_URL\" \"$DEST_DIR\"\n    cd \"$DEST_DIR\"\n    uv tool install .\n    ;;\nesac\n   ```\n\n### 5. 优化完成提示\n根据安装方式给出不同的提示：\n   ```bash\ncase \"$INSTALL_TYPE\" in\n  clone )\n    echo \"源码已下载到: $DEST_DIR\"\n    ;;\n  direct )\n    echo \"提示: 使用直接安装方式，源码未下载到本地。\"\n    echo \"如需查看或修改源码，请手动克隆仓库: git clone $REPO_URL\"\n    ;;\nesac\n   ```\n\n## 注意事项\n\n1. **uv tool install 的 git URL 格式**：\n   - 基本格式：`git+https://github.com/user/repo`\n   - 带额外依赖：`git+https://github.com/user/repo[extra1,extra2]`\n   - 指定分支/标签：`git+https://github.com/user/repo@branch-name`\n   - 指定提交：`git+https://github.com/user/repo@commit-hash`\n\n2. **错误处理**：\n   - 直接安装时使用 `set +e` 允许失败，实现降级策略\n   - 降级后恢复 `set -e` 确保后续错误能正确退出\n\n3. **变量命名**：\n   - 使用清晰的状态变量（如 `INSTALL_TYPE`）\n   - 镜像源 URL 使用明确的前缀（`GITEE_URL`、`GITHUB_URL`）\n\n4. **用户体验**：\n   - 默认选择快速安装方式（直接安装）\n   - 清晰说明每种方式的优缺点\n   - 提供后续操作的指引（如如何获取源码）\n\n## 可选步骤\n\n1. **添加版本选择**：\n   允许用户选择安装特定版本：\n   ```bash\n   uv tool install \"git+$REPO_URL@v1.0.0\"\n   ```\n\n2. **添加开发模式安装**：\n   对于克隆安装，支持可编辑模式：\n   ```bash\n   uv tool install --editable .\n   ```\n\n3. **支持本地路径安装**：\n   允许从本地已克隆的目录安装：\n   ```bash\n   uv tool install /path/to/local/repo\n   ```",
  "scope": "global"
}