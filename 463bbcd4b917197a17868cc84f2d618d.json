{
  "problem_type": "大型模块拆分重构",
  "content": "问题重述：\n当一个模块变得过大（如超过1000行）且职责过多时，需要将其拆分为多个功能域独立模块，以提高可维护性和可测试性。\n\n可复用解决流程（步骤化+工具）：\n\n阶段1：分析与规划\n1. 分析目标模块结构\n   - 使用 `wc -l filename.py` 统计行数\n   - 识别所有函数和类的功能边界\n   - 按功能域分组（如内存/IO/指针/线程/API等）\n\n2. 规划拆分方案\n   - 确定模块数量（建议每个模块<600行）\n   - 定义各模块的职责边界\n   - 识别共享依赖（如工具函数、类型定义）\n\n阶段2：迁移实施（按顺序执行）\n3. 创建新模块文件\n   - 为每个功能域创建独立文件（如memory_checker.py）\n   - 迁移相关函数（保持签名和行为不变）\n   - 导入必要的依赖（Issue类型、工具函数）\n   - 添加模块级文档字符串\n\n4. 验证单个模块\n   - 运行 `python -m mypy module.py` 检查类型\n   - 运行 `ruff check module.py` 检查代码风格\n   - 测试模块可正常导入\n\n5. 修改主模块\n   - 导入所有新模块\n   - 修改主函数调用各模块函数\n   - 删除已迁移的函数定义\n   - 保留工具函数和主函数\n\n阶段3：测试验证\n6. 创建集成测试\n   - 测试所有模块可正常导入\n   - 测试各模块功能独立正常\n   - 测试主函数集成功能\n   - 测试边界情况（空输入、注释处理等）\n\n7. 运行完整测试\n   - 执行 `pytest tests/ -v` 运行所有测试\n   - 确保测试覆盖率>=80%\n   - 确保所有测试通过\n\n阶段4：质量检查\n8. 验证重构结果\n   - 检查主模块行数<目标值\n   - 检查各子模块行数<目标值\n   - 运行 `mypy` 检查所有模块\n   - 运行 `ruff check` 检查代码风格\n\n9. 提交代码\n   - 每个阶段完成后提交\n   - 使用清晰的提交信息\n   - 便于回滚和审查\n\n注意事项：\n1. 必须保持公共接口不变（主函数签名不变）\n2. 必须使用TDD方法（先测试后重构）\n3. 必须小步快跑（每次改动后立即验证）\n4. 必须保持功能行为一致（重构前后测试结果相同）\n5. 禁止改变函数签名或行为\n6. 禁止跳过测试验证\n7. 禁止一次性大规模改动\n\n可选步骤：\n- 如果模块仍然过大，可进一步拆分\n- 可创建 __init__.py 导出公共接口\n- 可添加类型提示和文档字符串\n- 可优化导入顺序和依赖关系\n\n验收标准：\n- 主模块行数达到目标值\n- 各子模块行数合理（<600行）\n- mypy类型检查全部通过\n- ruff代码风格检查全部通过\n- 所有测试用例通过（100%）\n- 测试覆盖率>=80%\n- 功能行为与重构前一致",
  "scope": "global"
}