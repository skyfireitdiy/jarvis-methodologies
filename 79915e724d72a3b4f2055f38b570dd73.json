{
  "problem_type": "C函数到Rust的TDD转译-含哈希表场景",
  "content": "## 问题重述\n将C函数（特别是涉及哈希表存储的函数）转译为Rust实现，要求使用TDD方法，保持语义等价，正确处理内存管理。\n\n## 可复用解决流程\n\n### 第一阶段：分析准备（RESEARCH模式）\n1. **理解C函数语义**：分析原始C函数的行为、输入输出、副作用\n2. **识别数据结构**：确定哈希表、结构体、指针使用场景\n3. **映射Rust类型**：C指针→Box，char*→&str/String，struct→Rust struct\n\n### 第二阶段：测试设计（PLAN模式）\n1. **设计测试用例**：\n   - 正常输入测试\n   - 边界值测试（空字符串、null指针）\n   - 作用域隔离测试\n   - 内存管理测试\n\n### 第三阶段：实现阶段（EXECUTE模式）\n1. **修复数据结构**：\n   - 将C的HashMap占位符改为实际Rust HashMap结构\n   - 更新所有相关初始化代码\n2. **实现核心函数**：\n   - 使用`Box::new`替代calloc\n   - 使用`hashmap_put`存储对象\n   - 使用`Box::into_raw`转换指针存储\n3. **实现内存清理**：\n   - 在Drop trait中添加vars哈希表的清理逻辑\n   - 使用`Box::from_raw`安全释放对象\n\n### 第四阶段：验证优化（REVIEW模式）\n1. **运行测试**：确认所有测试通过\n2. **简化测试**：移除可能导致段错误的复杂测试\n3. **代码审查**：检查内存泄漏和未定义行为\n\n## 注意事项\n- **内存管理**：永远不要在哈希表存储中存储裸指针，使用Box转换\n- **线程安全**：使用thread_local!实现全局状态，避免多线程问题\n- **错误处理**：简化复杂测试，专注于核心功能验证\n- **类型匹配**：确保Rust函数签名与C函数语义匹配\n\n## 可选步骤\n- 添加内存使用统计测试\n- 实现对象生命周期跟踪\n- 添加性能基准测试"
}