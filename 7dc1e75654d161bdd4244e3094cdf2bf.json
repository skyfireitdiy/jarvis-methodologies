{
  "problem_type": "C函数到Rust的TDD转换",
  "content": "# C函数到Rust的TDD转译方法论\n\n## 问题重述\n将C函数按行为等价原则转译为Rust实现，使用测试驱动开发(TDD)确保正确性。\n\n## 可复用解决流程\n\n### 阶段1：分析准备（RESEARCH）\n1. **读取C源码**\n   - 使用read_code获取C函数完整实现\n   - 记录函数签名、参数类型、返回值类型\n   - 识别switch-case分支和错误处理逻辑\n\n2. **依赖分析**\n   - 使用read_symbols检查未转换符号\n   - 识别需要的Rust数据结构（Node、Variable等）\n   - 确认错误处理机制（CompileError枚举）\n\n### 阶段2：测试设计（INNOVATE→PLAN）\n1. **测试用例设计**\n   - 覆盖所有分支路径（ND_VAR、ND_DEREF、ND_MEMBER）\n   - 设计边界条件测试（局部变量vs全局变量）\n   - 包含错误情况测试（编译期常量错误、无效初始化器）\n\n2. **测试结构**\n   - 在#[cfg(test)] mod tests中添加测试\n   - 创建辅助函数构建测试节点\n   - 验证行为与C实现完全一致\n\n### 阶段3：实现阶段（EXECUTE）\n1. **数据结构补充**\n   - 根据C结构补充Rust字段（如Variable的is_local）\n   - 确保类型系统兼容性\n\n2. **函数实现**\n   - 按C逻辑逐分支实现match表达式\n   - 处理错误返回（CompileError）\n   - 维护label参数的可变性\n\n3. **验证测试**\n   - 运行cargo test确保所有测试通过\n   - 验证错误处理路径\n\n### 阶段4：优化（REVIEW）\n1. **代码清理**\n   - 移除临时测试代码\n   - 添加必要注释（中文）\n   - 确保代码风格一致\n\n## 注意事项\n- 禁止修改常量值，必须与C程序保持一致\n- 测试用例错误应修复而非删除\n- 保持最小变更，避免无关重构\n- 资源释放类函数通过RAII自动管理\n\n## 可选步骤\n- 性能基准测试（cargo bench）\n- 内存安全检查（clippy）\n- 集成测试验证"
}