{
  "problem_type": "测试失败修复流程",
  "content": "# 测试失败修复方法论\n\n## 问题重述\n当`cargo test`命令出现测试失败时，需要系统性定位并修复问题，确保所有测试用例通过。\n\n## 可复用解决流程\n\n### 步骤1: 识别失败测试\n- 运行 `cargo test -- --nocapture` 获取完整错误信息\n- 重点关注失败测试用例名称、断言错误、期望值与实际值差异\n- 记录失败位置（文件路径+行号）\n\n### 步骤2: 分析测试用例\n- 使用 `read_code` 工具读取失败的测试用例实现\n- 理解测试的预期行为（通过注释或断言信息）\n- 识别测试的输入数据、执行逻辑、预期输出\n\n### 步骤3: 检查被测函数\n- 使用 `read_code` 工具读取被测函数的完整实现\n- 对比测试期望的行为与函数实际行为\n- 特别注意边界条件处理（如整数溢出、空值等）\n\n### 步骤4: 识别根本原因\n- 分析是测试用例问题还是实现问题\n- 检查函数返回值计算逻辑（特别是原子操作、边界值处理）\n- 验证函数对特殊情况的处理（如wrapping行为、下溢出等）\n\n### 步骤5: 实施修复\n- 最小化修改原则：只修改变量计算逻辑，保持函数签名不变\n- 对于原子操作，正确处理`fetch_*`操作的返回值语义\n- 对于边界条件，使用合适的wrapping操作避免panic\n\n### 步骤6: 全面验证\n- 运行 `cargo test -- --nocapture` 确保所有测试通过\n- 检查修复是否引入回归问题（原成功测试是否仍然通过）\n- 验证边界条件测试的正确性\n\n## 注意事项\n- 原子操作`fetch_sub`返回操作前的值，计算新值需用`prev.wrapping_sub(1)`\n- 无符号整数下溢出在C中是定义行为，Rust中需显式使用wrapping操作\n- 修复后必须验证所有测试，包括原本成功的测试\n- 保持代码风格一致，中文注释\n\n## 可选步骤\n- 如需调试，可在关键位置添加临时`println!()`或`dbg!()`输出\n- 对于复杂场景，可运行单个测试用例：`cargo test test_name -- --nocapture`\n- 使用git重置功能作为回退策略"
}