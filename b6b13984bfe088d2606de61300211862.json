{
  "problem_type": "C语言到Rust移植的测试修复方法论",
  "content": "## C语言到Rust移植的测试修复方法论\n\n### 问题重述\n在C到Rust移植过程中，测试可能因以下原因失败：\n- 全局状态污染（如静态变量、临时文件）\n- 并发测试竞态条件\n- 行为语义差异（如panic vs assert）\n- 测试用例本身的问题\n\n### 可复用解决流程\n\n#### 步骤1：问题定位\n1. **单独验证**：对每个失败测试单独运行验证\n   ```bash\n   cargo test 测试模块::测试函数 -- --nocapture\n   ```\n2. **环境隔离**：清理全局状态（如临时文件、静态变量）\n3. **重复验证**：多次运行确认问题稳定性\n\n#### 步骤2：根因分析\n1. **代码审查**：检查相关函数的实现逻辑\n2. **行为对比**：对比C实现与Rust实现的语义差异\n3. **状态检查**：验证全局变量的初始化和访问逻辑\n\n#### 步骤3：修复策略\n1. **最小改动**：优先确认是否为临时性问题，避免过度修改\n2. **状态管理**：使用适当的同步机制（如Mutex、OnceLock）\n3. **测试验证**：修复后确保：\n   - 失败测试通过\n   - 原有测试不受影响\n   - 运行完整测试套件验证无回归\n\n#### 步骤4：验证确认\n1. **全面测试**：`cargo test -- --nocapture`\n2. **并发测试**：多次运行确认稳定性\n3. **边界检查**：检查边缘情况和异常处理\n\n### 注意事项\n- 在并发测试环境中，全局状态需要适当的重置机制\n- Rust的panic行为与C的assert行为需要保持一致性\n- 临时文件和全局变量应在测试间正确清理\n- 使用`should_panic`属性时需要确保panic信息匹配\n\n### 可选步骤\n- 添加测试隔离机制（如setup/teardown）\n- 增加调试输出定位问题\n- 考虑测试顺序依赖性"
}