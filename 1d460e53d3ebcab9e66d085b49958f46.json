{
  "problem_type": "Rust代码性能优化与安全检查",
  "content": "# Rust代码性能优化与安全检查方法论\n\n## 问题重述\n针对从C移植到Rust的代码，需要：\n1. 修复功能一致性问题（安全检查缺失）\n2. 修复性能严重问题（低效的逐字节操作）\n3. 保持API兼容性\n\n## 可复用解决流程\n\n### 阶段1：分析阶段\n1. **读取现有实现**：使用read_code获取完整函数实现\n2. **识别问题类型**：\n   - 输入验证缺失（零值、边界值检查）\n   - 性能瓶颈（逐字节处理、循环展开机会）\n   - 整数溢出风险（类型转换安全检查）\n\n### 阶段2：安全修复\n1. **添加输入验证**：\n   - 零值检查：`if value == 0 { return Ok(()) }`\n   - 边界检查：`if value > MAX_SIZE { return Err(...) }`\n   - 类型安全检查：`let safe_value = T::try_from(value)?`\n\n### 阶段3：性能优化\n1. **模式替换**：\n   - 逐字节→按字长复制\n   - 计算完整块数：`full_blocks = total / BLOCK_SIZE`\n   - 处理剩余部分：`remainder = total % BLOCK_SIZE`\n2. **汇编优化**：\n   - 使用对应字长的MOV指令（movb/movw/movl/movq）\n   - 按块复制减少指令数量\n\n### 阶段4：验证\n1. **构建验证**：确保代码无语法错误\n2. **行为一致性**：保持函数签名和副作用相同\n3. **边界测试**：验证极端情况的正确处理\n\n## 注意事项\n- 保持最小改动原则，避免重构\n- 确保所有unsafe操作都有安全检查\n- 注释使用中文，保持与项目风格一致\n- 优先修复严重问题（可能导致崩溃的），再修复性能问题\n\n## 可选步骤\n- 添加性能基准测试\n- 生成汇编代码对比验证优化效果"
}