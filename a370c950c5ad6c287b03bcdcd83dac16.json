{
  "problem_type": "C函数到Rust等效实现移植",
  "content": "# C函数到Rust等效实现移植方法论\n\n## 问题重述\n将C函数无损转换为Rust实现，保持行为等价但符合Rust语言特性和最佳实践。\n\n## 可复用解决流程\n\n### 阶段1：分析阶段\n1. **C代码解析**\n   - 使用`read_code`提取C函数完整实现\n   - 识别关键行为：输入输出、错误处理、副作用\n   - 记录特殊行为（如exit、全局变量、宏）\n\n2. **依赖分析**\n   - 用`lsp_client`检查C函数调用的所有符号\n   - 制作依赖映射表：C依赖 → Rust等效\n   - 检查是否已实现必要的基础设施\n\n### 阶段2：TDD设计阶段\n1. **测试用例设计**（3个标准测试）\n   ```\n   test_<func>_signature    // 验证函数签名正确性\n   test_<func>_basic        // 验证基本可调用性\n   test_<func>_boundary    // 验证边界/错误情况\n   ```\n\n2. **测试实现原则**\n   - 不依赖外部系统状态（使用mock或类型检查）\n   - 覆盖所有代码路径\n   - 验证错误处理分支\n\n### 阶段3：实现阶段\n1. **函数骨架**\n   ```rust\n   pub fn <func_name>() -> Result<ReturnType, Box<dyn std::error::Error>> {\n       // 实现\n   }\n   ```\n\n2. **行为映射表**\n   | C行为 | Rust等效 |\n   |-------|----------|\n   | `return value` | `Ok(value.to_string())` |\n   | `error(\"msg\")` | `Err(\"msg\".into())` |\n   | `file_exists` | `crate::common::fs::file_exists` |\n   | 全局路径常量 | 硬编码字符串或配置 |\n\n### 阶段4：验证阶段\n1. **语法验证**：`cargo check`\n2. **测试验证**：`cargo test <func_name>`\n3. **集成验证**：确保不影响现有功能\n\n## 注意事项\n- 路径处理：Linux路径用字符串，Windows需特殊处理\n- 错误类型：优先使用`Box<dyn Error>`保持灵活性\n- 内存管理：注意C的malloc/free → Rust的所有权系统\n- 并发安全：检查是否有共享状态需要处理\n\n## 可选增强步骤\n- 添加性能基准测试\n- 实现更具体的错误类型\n- 添加配置化路径支持\n- 实现mock系统便于测试"
}