{
  "problem_type": "WasmEdge C API编译演示",
  "content": "# WasmEdge C API编译演示方法论\n\n## 问题重述\n如何使用WasmEdge C API编译和运行WebAssembly程序，展示嵌入式WebAssembly运行时的核心能力。\n\n## 可复用解决流程\n\n### 1. 环境准备\n- 确保WasmEdge已成功构建，库文件位于`build/lib/api/`\n- 确认头文件位于`include/`或`include/api/`目录\n- 安装必要的依赖（如json-c等，根据具体示例需求）\n\n### 2. 选择或创建示例程序\n**选项A：使用现有示例**\n- 检查`examples/capi/`目录下的示例（如host_functions、wasi-env等）\n- 阅读README了解示例功能\n\n**选项B：创建简单演示**\n创建基础C程序演示核心功能：\n```c\n#include <stdio.h>\n#include <wasmedge/wasmedge.h>\n\nint main() {\n  // 创建VM上下文\n  WasmEdge_VMContext *VMCxt = WasmEdge_VMCreate(NULL, NULL);\n \n  // 创建函数名字符串\n  WasmEdge_String FuncName = WasmEdge_StringCreateByCString(\"function_name\");\n \n  // 准备参数和返回值\n  WasmEdge_Value Params[N] = { /* 使用WasmEdge_ValueGenI32()等创建 */ };\n  WasmEdge_Value Returns[M];\n \n  // 调用WASM函数\n  WasmEdge_Result Res = WasmEdge_VMRunWasmFromFile(\n      VMCxt, \"path/to/module.wasm\", FuncName, Params, N, Returns, M);\n \n  // 处理结果\n  if (WasmEdge_ResultOK(Res)) {\n    // 获取返回值：int result = WasmEdge_ValueGetI32(Returns[0]);\n    printf(\"Success\\\\n\");\n  } else {\n    printf(\"Error: %s\\\\n\", WasmEdge_ResultGetMessage(Res));\n}\n \n  // 清理资源\n  WasmEdge_StringDelete(FuncName);\n  WasmEdge_VMDelete(VMCxt);\n  return 0;\n}\n```\n\n### 3. 编译C程序\n使用gcc编译，指定include路径和库路径：\n```bash\ngcc source.c \\\n    -I/path/to/wasmedge/include \\\n    -L/path/to/wasmedge/build/lib/api \\\n    -lwasmedge \\\n    -Wl,-rpath=/path/to/wasmedge/build/lib/api \\\n    -o output_program\n```\n\n**关键点：**\n- `-I`指定头文件路径（include/或include/api/）\n- `-L`指定库文件路径\n- `-lwasmedge`链接WasmEdge库\n- `-Wl,-rpath=`设置运行时库搜索路径，避免LD_LIBRARY_PATH\n\n### 4. 准备WASM模块\n**选项A：使用预编译的WASM**\n- 使用项目中已有的WASM文件（如examples/wasm/目录下）\n\n**选项B：编译WAT为WASM**\n- 使用wat2wasm工具：`wat2wasm input.wat -o output.wasm`\n- 注意：某些WABT版本不支持externref类型，如需使用需升级工具\n\n### 5. 运行演示\n执行编译后的程序，验证WASM函数调用成功\n\n## 核心技术要点\n\n### WasmEdge C API关键函数\n- **VM创建/销毁**：`WasmEdge_VMCreate()`, `WasmEdge_VMDelete()`\n- **函数调用**：`WasmEdge_VMRunWasmFromFile()`\n- **参数创建**：`WasmEdge_ValueGenI32()`, `WasmEdge_ValueGenI64()`, `WasmEdge_ValueGenF32()`, `WasmEdge_ValueGenF64()`\n- **返回值获取**：`WasmEdge_ValueGetI32()`, `WasmEdge_ValueGetI64()`, `WasmEdge_ValueGetF32()`, `WasmEdge_ValueGetF64()`\n- **字符串处理**：`WasmEdge_StringCreateByCString()`, `WasmEdge_StringDelete()`\n- **结果检查**：`WasmEdge_ResultOK()`, `WasmEdge_ResultGetMessage()`\n\n### 资源管理\n- 必须正确清理VM上下文和字符串对象\n- 使用`WasmEdge_VMDelete()`释放VM\n- 使用`WasmEdge_StringDelete()`释放字符串\n\n### 主机函数（高级用法）\n- 使用`WasmEdge_FunctionInstanceCreate()`创建主机函数\n- 使用`WasmEdge_VMRegisterModuleFromImport()`注册模块\n- 展示宿主语言与WASM模块的交互能力\n\n## 注意事项\n\n### WABT版本限制\n- wat2wasm 1.0.13不支持externref类型\n- 如需使用externref，需升级到支持WebAssembly引用类型提案的版本\n\n### 路径问题\n- 编译时使用相对路径或绝对路径\n- 运行时WASM文件路径可以是相对路径（相对于工作目录）\n\n### 库链接\n- 必须设置rpath，否则运行时会找不到libwasmedge.so\n- 或使用LD_LIBRARY_PATH环境变量\n\n### 错误处理\n- 始终检查`WasmEdge_ResultOK(Res)`\n- 使用`WasmEdge_ResultGetMessage()`获取详细错误信息\n\n## 应用场景\n\n1. **嵌入式集成**：在C/C++应用中集成WebAssembly运行时\n2. **主机函数调用**：宿主语言提供函数供WASM调用\n3. **WASI环境配置**：通过C API配置WASM的WASI环境\n4. **多实例管理**：创建多个VM实例并行运行不同的WASM模块\n5. **性能优化**：通过AOT编译和缓存优化WASM执行性能\n\n## 相关资源\n\n- WasmEdge官方文档：https://wasmedge.org/book/en/\n- C API参考：include/wasmedge/wasmedge.h\n- 示例代码：examples/capi/目录",
  "scope": "global"
}