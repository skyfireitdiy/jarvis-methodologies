{
  "problem_type": "AI代码生成验证审查",
  "content": "# AI代码生成验证审查方法论\n\n## 规则简介\n\n本方法论用于审查AI生成的代码是否正确完成了用户需求，特别关注代码生成总结与实际代码的一致性验证。适用于所有AI辅助代码生成场景。\n\n## 你必须遵守的原则\n\n### 原则1：不盲目信任总结，必须验证实际代码\n\n**要求说明：**\n\n- **必须**：将代码生成总结视为\"待核实的说明\"，而非事实\n- **必须**：对总结中提到的每个关键修改点，在git diff或实际代码中找到对应依据\n- **必须**：如发现总结与实际代码不一致，在审查结果中明确指出\n- **禁止**：仅基于总结进行审查，不查看实际代码\n- **禁止**：假设总结中提到的功能已经实现\n\n### 原则2：执行自动化验证，确保代码质量\n\n**要求说明：**\n\n- **必须**：运行代码质量检查工具（如ruff、mypy、pylint等）\n- **必须**：运行完整的测试套件，验证所有测试通过\n- **必须**：验证模块可以正常导入和实例化\n- **禁止**：跳过自动化验证步骤\n- **禁止**：仅依赖人工检查代码\n\n### 原则3：验证完整性，确保需求全部实现\n\n**要求说明：**\n\n- **必须**：对照用户需求的验收标准，逐项检查是否完成\n- **必须**：验证所有声称的文件、类、方法是否真实存在\n- **必须**：检查测试覆盖率是否达到要求\n- **禁止**：仅验证部分功能点\n- **禁止**：忽略验收标准中的任何一项\n\n## 你必须执行的操作\n\n### 阶段1：解析需求和总结\n\n1. **提取验收标准**\n   - 从用户需求中提取明确的验收标准\n   - 识别关键功能点和性能指标\n   - 记录测试覆盖率要求\n\n2. **分析代码生成总结**\n   - 提取总结中声称的所有修改点\n   - 识别新增的文件、类、方法\n   - 记录声称的测试数量和覆盖率\n\n### 阶段2：验证代码质量\n\n1. **运行静态代码检查**\n   - 验证代码风格符合规范（如ruff check）\n   - 验证类型注解正确（如mypy --strict）\n   - 检查是否有明显的代码质量问题\n\n2. **运行测试套件**\n   - 验证所有测试通过\n   - 检查测试数量是否与总结一致\n   - 验证测试覆盖率是否达标\n\n3. **验证模块导入**\n   - 编写简单脚本验证模块可以导入\n   - 验证核心类可以实例化\n   - 验证核心方法可以调用\n\n### 阶段3：验证代码与总结的一致性\n\n1. **逐项核对总结中的声明**\n   - 对于每个声称新增的文件，在git diff中查找\n   - 对于每个声称的类/方法，使用read_code工具验证\n   - 对于每个声称的功能，验证实际实现\n\n2. **检查关键实现细节**\n   - 验证数据类的字段是否完整\n   - 验证方法签名是否与总结一致\n   - 验证依赖关系是否正确\n\n3. **记录不一致之处**\n   - 如发现总结与代码不符，详细记录\n   - 评估不一致是否影响功能完整性\n   - 判断是否需要修复\n\n### 阶段4：验证需求完成度\n\n1. **对照验收标准逐项检查**\n   - 功能完整性：所有功能点是否实现\n   - 代码正确性：逻辑是否正确，有无bug\n   - 代码质量：是否符合最佳实践\n   - 测试覆盖：测试是否充分\n\n2. **检查附加产物**\n   - 文档是否更新（如README、API文档）\n   - 配置文件是否正确修改\n   - 依赖是否正确添加\n\n3. **验证集成完整性**\n   - 新模块是否正确集成到项目中\n   - 导入路径是否正确配置\n   - __init__.py是否正确导出\n\n### 阶段5：生成审查报告\n\n1. **汇总验证结果**\n   - 列出所有通过的验收标准\n   - 列出所有发现的问题\n   - 评估整体完成度\n\n2. **提供改进建议**\n   - 对于发现的问题，提供具体修复建议\n   - 对于代码质量问题，提供优化建议\n   - 对于不一致之处，说明影响和处理方式\n\n## 实践指导\n\n### 使用工具的最佳实践\n\n1. **read_code工具**\n   - 用于验证总结中提到的类/方法是否存在\n   - 用于检查方法签名和实现细节\n   - 优先查看关键模块的核心代码\n\n2. **execute_script工具**\n   - 用于运行自动化检查（ruff、mypy、pytest）\n   - 用于验证模块导入和基本功能\n   - 使用管道和过滤命令限制输出长度\n\n3. **批量验证策略**\n   - 可以在一次execute_script调用中运行多个检查\n   - 使用 && 连接命令，确保前一个成功才执行下一个\n   - 使用 echo 分隔不同检查的输出\n\n### 常见问题处理\n\n1. **总结与代码不一致**\n   - 以实际代码为准\n   - 在审查报告中明确指出不一致\n   - 评估是否影响功能完整性\n\n2. **测试失败**\n   - 检查是否是环境问题\n   - 查看失败的测试用例\n   - 判断是代码问题还是测试问题\n\n3. **导入错误**\n   - 检查__init__.py是否正确配置\n   - 检查模块路径是否正确\n   - 验证依赖是否安装\n\n## 检查清单\n\n### 代码质量验证\n- [ ] ruff检查通过\n- [ ] mypy检查通过（如适用）\n- [ ] 其他静态检查工具通过\n\n### 测试验证\n- [ ] 所有测试通过\n- [ ] 测试数量与总结一致\n- [ ] 测试覆盖率达标（通常≥80%）\n\n### 功能验证\n- [ ] 所有声称的文件已创建\n- [ ] 所有声称的类/方法已实现\n- [ ] 模块可以正常导入\n- [ ] 核心功能可以正常调用\n\n### 需求验证\n- [ ] 所有验收标准已满足\n- [ ] 所有功能点已实现\n- [ ] 文档已更新（如需要）\n- [ ] 集成完整（__init__.py、导入路径等）\n\n### 一致性验证\n- [ ] 总结与实际代码一致\n- [ ] 如有不一致，已记录并评估影响\n- [ ] 所有声称的改进已验证",
  "scope": "global"
}