{
  "problem_type": "Rust测试中全局状态污染问题",
  "content": "### 问题重述\n在Rust测试中，静态变量或全局状态在不同测试间共享，导致测试间状态污染，出现测试失败或不稳定的情况。\n\n### 可复用解决流程\n\n#### 步骤1：识别问题\n- 运行测试：`cargo test [失败测试名] -- --nocapture`\n- 观察错误模式：测试单独运行通过，但批量运行失败\n- 识别共享状态：查找`static`变量、`lazy_static`、`once_cell`等全局状态\n\n#### 步骤2：分析状态污染\n- 使用工具：`execute_script` + `grep`/`rg`查找静态变量\n- 验证污染：比较测试运行前后的状态差异\n- 确定污染源：记录哪个变量在不同测试间未正确重置\n\n#### 步骤3：修复策略选择\n根据具体情况选择以下策略之一：\n- **初始化修复**：确保静态变量有正确的初始状态（如本例中SCOPES初始化为包含1个默认作用域）\n- **测试隔离**：使用`std::sync::Mutex`或`RwLock`包装状态，测试前后重置\n- **测试工具函数**：创建专门的测试辅助函数管理状态生命周期\n\n#### 步骤4：实施修复\n- 修改静态变量初始化逻辑\n- 添加测试前的状态重置机制\n- 确保线程安全（如需要）\n\n#### 步骤5：验证修复\n1. 单独运行失败测试：`cargo test [测试名] -- --nocapture`\n2. 运行完整测试套件：`cargo test -- --nocapture`\n3. 重复运行验证稳定性：`cargo test -- --nocapture`多次\n\n#### 步骤6：回归预防\n- 添加测试注释说明状态管理要求\n- 创建测试模式文档\n- 考虑使用测试夹具（test fixtures）\n\n### 注意事项\n- 避免在测试中修改全局状态，除非绝对必要\n- 使用`#[serial]`属性或类似机制控制测试执行顺序（最后手段）\n- 考虑将全局状态重构为可注入的依赖项\n\n### 可选步骤\n- 使用`cargo-tarpaulin`检查测试覆盖率\n- 创建专门的集成测试模块隔离全局状态测试\n- 使用`tempfile`或类似crate管理临时状态"
}