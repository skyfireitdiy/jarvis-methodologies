{
  "problem_type": "Rust测试状态污染诊断",
  "content": "# Rust测试状态污染诊断方法论\n\n## 问题重述\n测试在单独运行时通过，但在完整测试套件中失败，通常表现为：\n- 返回错误的数值（如usize::MAX而非预期值）\n- 测试间共享状态不一致\n- 间歇性失败\n\n## 诊断流程\n\n### 步骤1：快速验证\n```bash\n# 单独运行失败测试\ncargo test 测试名称 -- --nocapture\n\n# 完整运行确认问题\ncargo test -- --nocapture\n```\n\n### 步骤2：状态污染定位\n1. **检查全局变量**：查找static变量或lazy_static共享状态\n2. **验证测试隔离**：确认每个测试是否独立设置初始状态\n3. **检查并发保护**：验证Mutex/RwLock等同步机制是否正确使用\n\n### 步骤3：修复策略\n- **测试隔离**：在测试开始时重置所有共享状态\n- **并发控制**：使用全局锁确保测试串行执行\n- **状态验证**：添加调试输出验证状态初始值\n\n### 步骤4：验证修复\n运行完整测试套件5次以上，确保问题不再复现\n\n## 注意事项\n- 优先检查使用static Atomic变量的测试\n- 注意测试执行顺序可能影响结果\n- 使用`--test-threads=1`作为临时解决方案验证并发问题"
}