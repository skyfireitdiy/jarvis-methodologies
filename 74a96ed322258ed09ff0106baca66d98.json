{
  "problem_type": "目录重构整理",
  "content": "# 目录重构整理方法论\n\n## 问题重述\n将现有目录结构调整为新的组织形式，通常包括：\n- 按功能/模块分类创建子目录\n- 将文件移动到对应分类目录\n- 更新索引或引用文件中的路径\n- 验证重构结果的正确性\n\n## 可复用解决流程\n\n### 1. 分析阶段\n**目标**：理解目标结构，评估影响范围\n- 分析参考目录的组织形式（如 builtin/rules 的分类方式）\n- 列出现有文件及其功能分类\n- 识别所有可能引用这些路径的文件（索引、配置、文档等）\n- 确定是否需要保持原目录名称不变\n\n**关键检查**：\n   ```\nfind target_dir -type f -name \"*.ext\"  # 列出所有文件\ngrep -r \"old_path\" project_dir         # 搜索可能的路径引用\n   ```\n\n### 2. 设计阶段\n**目标**：制定详细的重构方案\n- 确定子目录分类（按功能、模块、类型等）\n- 规划文件到目录的映射关系\n- 决定是否拆分大文件（可选）\n- 列出需要更新的路径引用\n\n**决策原则**：\n- 文件拆分：保持文件完整性 vs 单一职责原则\n- 分类粒度：过粗（不清晰）vs 过细（碎片化）\n- 命名规范：与参考结构保持一致\n\n### 3. 实施阶段\n**目标**：按计划执行重构，保持可回退\n\n#### 3.1 创建目录结构\n   ```bash\nmkdir -p target_dir/category1\nmkdir -p target_dir/category2\n# ... 按需创建其他分类目录\n   ```\n\n#### 3.2 移动文件\n   ```bash\nmv target_dir/file1.md target_dir/category1/\nmv target_dir/file2.md target_dir/category2/\n   ```\n\n**注意事项**：\n- 使用 mv 而非 cp+rm，保持文件完整性\n- 确保目标目录已存在\n- 按依赖顺序移动（先移动被引用的文件）\n\n#### 3.3 更新路径引用\n使用 edit_file 工具精确修改：\n- 搜索足够的上下文以确保唯一匹配\n- 批量更新同一路径的多处引用\n- 保持文件格式和风格一致\n\n**修改示例**：\n   ```bash\n# 更新前检查\ngrep -n \"old_path\" index_file\n\n# 使用 edit_file 工具进行精确替换\n# search: 必须包含足够上下文\n# replace: 仅修改路径部分\n   ```\n\n### 4. 验证阶段\n**目标**：确保所有变更正确且完整\n\n#### 4.1 目录结构验证\n   ```bash\nfind target_dir -type d | sort  # 查看目录树\nfind target_dir -type f -name \"*.md\" | sort  # 确认所有文件位置\n   ```\n\n#### 4.2 文件完整性验证\n   ```bash\nls -la target_dir/category1/file1.md  # 检查文件存在\nhead -n 10 target_dir/category1/file1.md  # 检查文件可读\n   ```\n\n#### 4.3 路径引用验证\n   ```bash\ncat index_file  # 确认路径已更新\ngrep \"new_path\" index_file  # 验证新路径正确\n   ```\n\n#### 4.4 对比验证\n   ```bash\n# 对比重构前后结构\necho \"=== 目标结构 ===\" && find target_dir -maxdepth 2 -type d\necho \"=== 参考结构 ===\" && find reference_dir -maxdepth 2 -type d\n   ```\n\n## 注意事项\n\n### 安全性保障\n1. **备份重要文件**：在移动前备份索引和配置文件\n2. **Git 版本控制**：每个步骤独立提交，便于回退\n3. **分批执行**：先移动少量文件，验证后再继续\n\n### 常见风险\n1. **循环引用**：文件间相互引用，移动顺序不当导致错误\n   - 解决：分析依赖图，按拓扑顺序移动\n2. **路径遗漏**：某些文件或配置未更新路径\n   - 解决：全局搜索 old_path 确保无遗漏\n3. **权限问题**：文件移动后权限丢失\n   - 解决：检查并恢复权限（chmod/chown）\n4. **软链接失效**：移动文件后软链接指向错误位置\n   - 解决：更新或重建软链接\n\n### 特殊情况处理\n1. **空目录清理**：移动文件后清理空的原目录\n   ```bash\n   find target_dir -type d -empty -delete\n   ```\n2. **文件名冲突**：目标目录已有同名文件\n   - 解决：重命名或合并文件内容\n3. **大文件拆分**：按分类拆分大文件到多个子文件\n   - 解决：评估必要性，拆分后保持内容完整性\n\n## 可选步骤\n\n### 高级功能\n- **自动脚本化**：对于大量文件，编写 Shell/Python 脚本自动化\n- **文件重命名**：同时调整文件名以匹配新分类（可选）\n- **文档更新**：更新 README、CHANGELOG 等文档反映结构变化\n\n### 验证增强\n- **语法检查**：对于代码文件，检查移动后是否可正常编译\n- **功能测试**：运行测试套件确保功能未受影响\n- **链接检查**：检查文档中的内部链接是否有效\n\n## 最佳实践\n\n1. **保持一致性**：与现有项目结构或参考结构保持一致\n2. **渐进式重构**：避免大规模一次性重构，分阶段进行\n3. **文档同步**：及时更新相关文档和索引\n4. **团队沟通**：重构前与团队沟通，获取反馈和支持\n5. **回退准备**：准备回退方案，确保可快速恢复",
  "scope": "global"
}