{
  "problem_type": "修复Rust测试失败问题",
  "content": "## 问题重述\nRust项目测试中出现的常见失败类型：函数返回值逻辑错误、并发锁PoisonError、测试期望与实际结果不符。\n\n## 可复用解决流程\n\n### 阶段1：问题识别与定位\n1. **运行完整测试**：`cargo test -- --nocapture` 获取所有失败信息\n2. **单独运行失败测试**：`cargo test <test_name> -- --nocapture` 隔离问题\n3. **分析失败模式**：\n   - 返回值不匹配：检查函数实现与测试期望\n   - PoisonError：检查并发锁使用\n   - 断言失败：验证测试逻辑正确性\n\n### 阶段2：修复策略\n1. **Atomic操作返回值问题**：\n   - 识别使用 `Atomic*` 类型的函数\n   - 确认测试期望返回值（新值 vs 旧值）\n   - 使用 `wrapping_add/wrapping_sub` 计算正确返回值\n\n2. **并发锁污染问题**：\n   - 搜索所有 `TEST_LOCK.lock().unwrap()` 使用\n   - 统一替换为 `TEST_LOCK.lock().unwrap_or_else(|e| e.into_inner())`\n   - 确保测试间状态隔离\n\n3. **C源码翻译验证**：\n   - 对比原始C实现与Rust翻译\n   - 验证边界条件和异常处理\n   - 添加必要的panic处理\n\n### 阶段3：验证与回归测试\n1. **编译检查**：`cargo check --message-format=short`\n2. **Clippy检查**：`cargo clippy -- -D warnings`\n3. **完整测试**：`cargo test -- --nocapture`\n4. **稳定性验证**：多次运行测试确认无并发问题\n\n## 注意事项\n- 修复时要同步检查所有相关测试用例\n- 避免只修复表面问题而忽略根本原因\n- 保持最小改动原则，避免过度重构\n- 修复后清理所有临时调试输出\n\n## 可选步骤\n- 添加更多边界测试用例\n- 考虑使用 `loom` 进行并发测试\n- 集成CI/CD自动测试流程"
}