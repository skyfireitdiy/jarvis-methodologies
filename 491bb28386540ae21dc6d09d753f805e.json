{
  "problem_type": "代码依赖关系分析与删除安全验证",
  "content": "## 代码依赖关系分析与删除安全验证方法\n\n### 问题场景\n在代码重构或功能迁移时，需要删除一批旧函数，但必须确保：\n1. 函数定位准确（名称、行号范围）\n2. 函数调用关系清晰\n3. 删除不会影响其他功能（无外部依赖）\n\n### 解决流程\n\n#### 步骤1：定位目标函数\n使用 grep/rg 搜索函数定义：\n```bash\ngrep -n \"^def _function_pattern\" filepath.py\n```\n\n#### 步骤2：读取函数代码获取精确行号范围\n- 使用 read_code 或源代码查看工具\n- 记录每个函数的起始行和结束行（下一个函数定义前一行）\n\n#### 步骤3：分析调用关系\n在整个项目范围内搜索函数调用：\n```bash\n# 搜索所有调用（排除函数定义）\nrg \"function_name\" --type py src/ -n | grep -v \"^def \" | grep -v \":.*:def \"\n```\n\n#### 步骤4：验证调用安全性\n- 确认所有调用者是否在预期范围内\n- 检查是否存在意外的外部调用\n- 评估删除对系统的影响\n\n#### 步骤5：生成验证报告\n包含以下内容：\n1. 完整函数列表及行号范围\n2. 每个函数的调用关系（调用者列表）\n3. 安全删除确认（是否只被目标函数调用）\n\n### 注意事项\n1. **排除定义行**：搜索调用时必须排除 `^def ` 开头的行\n2. **区分内部和外部调用**：确认调用是否来自同一模块或外部依赖\n3. **保留关键函数**：某些函数即使被删除函数调用，本身可能仍需保留\n4. **动态调用**：注意 Python 的动态特性（如 getattr、字符串拼接调用）\n\n### 可选增强\n- 使用 AST 解析进行更精确的调用分析\n- 生成调用关系图（使用 graphviz 等工具）\n- 集成到 CI/CD 流程中防止引入新依赖"
}