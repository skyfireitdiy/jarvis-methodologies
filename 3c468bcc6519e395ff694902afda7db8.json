{
  "problem_type": "重构Spec编写",
  "content": "# 重构Spec编写方法论\n\n## 问题重述\n如何为需要重构的大型模块编写详细、完整的功能规范文档，确保职责拆分合理、接口定义清晰、验收标准可验证。\n\n## 可复用解决流程\n\n### 1. 代码分析阶段\n1. **完整读取目标代码**：分段读取，确保理解所有功能模块\n2. **识别职责分布**：\n   - 列出所有类、方法和主要功能\n   - 识别哪些职责混在一起（如任务管理、验证、执行、UI等）\n   - 统计代码行数，识别超标模块\n3. **识别问题点**：\n   - 职责过多（单一类承担多个独立职责）\n   - 代码行数超标（建议<1000行）\n   - 耦合度高（模块间相互依赖）\n   - 扩展性差（修改需要影响大范围代码）\n\n### 2. 职责拆分阶段\n1. **确定模块划分原则**：\n   - 单一职责原则：每个模块只做一件事\n   - 高内聚低耦合：相关功能聚在一起，减少依赖\n   - 合理规模：每个模块<1000行\n2. **设计模块关系图**：\n   - 明确模块间的依赖关系（使用树状图或依赖图）\n   - 标注每个模块的职责描述和预估行数\n3. **定义模块接口**：\n   - 为每个模块定义清晰的接口\n   - 明确输入输出格式\n   - 定义边界条件和异常处理\n\n### 3. Spec文档编写阶段\n1. **必需章节**：\n   - **功能概述**：模块定位、核心功能、当前问题\n   - **职责拆分方案**：模块划分表格、模块关系图\n   - **模块详细设计**：每个模块的职责、接口、输入输出、边界条件、异常处理\n   - **输入输出说明**：工具参数定义、返回值格式\n   - **边界条件**：各种边界情况的处理规则\n   - **异常处理**：异常分类、处理策略、错误消息规范\n   - **验收标准**：功能完整性、代码质量、测试覆盖、性能要求、可维护性、文档完整性\n   - **实施计划**：分阶段实施步骤、风险控制\n   - **附录**：术语表、参考资料\n\n2. **编写规范**：\n   - 使用Markdown格式，结构清晰\n   - 接口定义使用代码块，方便复制\n   - 表格用于对比和总结\n   - 列表用于步骤和要点\n\n### 4. 验收标准设计\n验收标准必须可验证，包括：\n- **功能完整性**：所有现有功能保持不变、所有测试通过\n- **代码质量**：每个模块<1000行、符合单一职责、符合编码规范\n- **测试覆盖**：单元测试覆盖率≥80%、包括正常/边界/异常情况\n- **性能要求**：关键操作的性能指标\n- **可维护性**：模块职责清晰、易于扩展\n- **文档完整性**：每个模块有独立文档、接口定义完整\n\n## 注意事项\n\n1. **Spec先于实现**：必须先完成Spec文档，未经确认不得进入实现阶段\n2. **保持功能不变**：重构的目的是提升质量，不是改变功能\n3. **小步快跑**：分阶段实施，每个阶段独立测试\n4. **可回退**：每个阶段提交独立commit，便于回退\n5. **向后兼容**：对外接口保持不变，不影响现有使用\n\n## 示例结构\n\n```markdown\n# [模块名] 功能规范文档\n\n## 1. 功能概述\n### 1.1 模块定位\n### 1.2 核心功能\n### 1.3 当前问题\n\n## 2. 职责拆分方案\n### 2.1 模块划分（表格）\n### 2.2 模块关系图\n\n## 3. 模块详细设计\n### 3.X [模块名]\n- 职责\n- 接口定义\n- 输入输出\n- 边界条件\n- 异常处理\n\n## 4. 输入输出说明\n## 5. 边界条件\n## 6. 异常处理\n## 7. 验收标准\n## 8. 实施计划\n## 9. 附录\n```\n\n## 参考资料\n- SDD流程规范：遵循Spec驱动开发原则\n- TDD流程规范：先写测试再实现\n- SOLID设计原则：单一职责、开闭原则等",
  "scope": "global"
}