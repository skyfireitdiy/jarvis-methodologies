{
  "problem_type": "Rust测试失败分析",
  "content": "## 问题重述\nRust测试中作用域管理相关的测试用例失败，具体表现为：test_find_tag_not_found测试期望返回None但实际返回Some，涉及全局状态管理和测试隔离问题。\n\n## 可复用解决流程\n\n### 步骤1：快速验证测试状态\n```bash\n# 运行单个测试用例验证当前状态\ncargo test 模块名::测试名 -- --nocapture\n```\n\n### 步骤2：检查测试环境和全局状态\n- 查看测试用例的setup/teardown逻辑\n- 确认clear_scopes()、clear_typedefs()等清理函数是否正确实现\n- 验证测试间是否有状态污染\n\n### 步骤3：代码审查重点\n- 检查find_tag函数的实现逻辑\n- 验证add_tag是否正确添加标签到作用域\n- 确认作用域查找顺序（从最近到最远）\n\n### 步骤4：状态隔离验证\n- 使用read_code工具检查测试清理机制\n- 运行测试集验证清理是否彻底\n- 使用execute_script验证测试顺序对结果的影响\n\n### 步骤5：修复验证\n- 修复后重新运行单个测试确认通过\n- 运行整个测试模块确保无回归\n- 使用cargo test -v验证详细执行过程\n\n## 注意事项\n1. 全局状态变量必须使用Mutex等同步原语保护\n2. 测试清理函数必须彻底重置状态，包括清空容器和释放内存\n3. 避免测试间依赖，每个测试应该是独立的\n4. 使用Lazy静态变量时特别注意初始化时机\n\n## 可选步骤\n- 添加调试日志查看作用域状态\n- 使用println!或log输出中间状态\n- 创建专门的测试工具函数验证状态清理"
}