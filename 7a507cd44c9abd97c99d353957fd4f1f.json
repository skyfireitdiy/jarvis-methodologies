{
  "problem_type": "C到Rust代码移植",
  "content": "# C到Rust代码移植方法论\n\n## 适用场景\n将C语言实现的编译器/解析器/系统级工具迁移到Rust，保持功能一致性\n\n## 解决流程\n\n### 1. 需求分析阶段\n- **工具使用**：read_code + 审查报告\n- **关键动作**：识别C实现中的核心函数、数据结构、调用关系\n- **输出**：需要移植的功能清单和依赖关系图\n\n### 2. 代码映射阶段\n- **工具使用**：read_symbols + lsp_client\n- **关键动作**：建立C类型到Rust类型的映射表\n- **示例**：\n  ```c\n  // C\n  Type* ty;\n  Obj* var;\n  ```\n  ```rust\n  // Rust\n  Box<Type> ty;\n  Box<Obj> var;\n  ```\n\n### 3. 最小修改实现\n- **工具使用**：edit_file（优先sed） + execute_script\n- **原则**：\n  1. 保持函数签名不变\n  2. 最小化修改范围\n  3. 逐步验证每个修改\n- **执行顺序**：\n  1. 先修复编译错误\n  2. 再实现缺失功能\n  3. 最后优化性能\n\n### 4. 验证阶段\n- **工具使用**：execute_script运行测试\n- **标准**：\n  - 所有原有测试必须通过\n  - 新功能测试必须覆盖\n  - 构建警告控制在可接受范围内\n\n### 5. 清理阶段\n- **工具使用**：edit_file处理警告\n- **动作**：清理临时变量、未使用代码、格式问题\n\n## 注意事项\n1. **类型系统差异**：C的指针在Rust中用Box/Option<Box>\n2. **内存管理**：利用Rust的所有权系统，避免手动内存管理\n3. **错误处理**：用Option/Result替代C的NULL返回\n4. **警告处理**：优先修复编译错误，警告可后续处理\n\n## 质量检查清单\n- [ ] 编译通过\n- [ ] 所有测试通过\n- [ ] 新增功能有测试覆盖\n- [ ] 代码风格一致\n- [ ] 无内存安全问题\n\n该方法论已通过实际验证，适用于编译器/解析器类项目的C到Rust移植。"
}