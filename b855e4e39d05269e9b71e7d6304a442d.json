{
  "problem_type": "UTFT评审",
  "content": "# UTFT评审方法论\n\n## 规则简介\n\n本方法论用于指导单元测试变更的评审流程，确保测试用例正确对应代码变更，测试覆盖充分，场景设计合理。适用于需要对UTFT变更进行Gerrit代码走查的场景。\n\n## 你必须遵守的原则\n\n### 评审完整性原则\n\n**要求说明：**\n\n- **必须**：评审前必须应用patch并查看完整的变更内容\n- **必须**：必须验证测试用例是否正确对应代码变更的所有功能点\n- **必须**：必须评估测试覆盖率是否充分（正常路径、边界条件、异常处理）\n- **禁止**：禁止仅凭commit message或变更统计就做出评审结论\n\n### 对应性验证原则\n\n**要求说明：**\n\n- **必须**：UTFT变更必须与对应的代码变更关联分析\n- **必须**：验证所有新增/修改的API是否都有对应的测试用例\n- **必须**：检查测试用例中的参数传递、函数调用是否正确更新\n- **禁止**：禁止遗漏对新增参数的测试覆盖\n\n### 场景合理性原则\n\n**要求说明：**\n\n- **必须**：测试场景应覆盖正常场景、边界条件、异常场景\n- **必须**：关键路径必须有独立的测试用例\n- **必须**：边界值（如0、-1、最大值、最小值）应有测试覆盖\n- **建议**：使用参数化测试或数据驱动测试来减少重复代码\n\n## 你必须执行的操作\n\n### 阶段1：准备阶段\n\n1. **切换到正确的代码仓库**：\n   - 根据变更信息确认是idf库还是idf_ft库\n   - 使用 `cd ~/code/CoNAP/[repo_name]` 切换目录\n\n2. **应用patch**：\n   - 执行 `git fetch origin refs/changes/[后两位]/[change-id]/[patchset]`\n   - 执行 `git checkout FETCH_HEAD` 应用补丁\n\n3. **获取变更信息**：\n   - 使用 `git show --name-only` 查看变更文件列表\n   - 使用 `git show` 或 `git diff` 查看详细变更内容\n   - 使用 `read_code` 工具读取相关测试文件\n\n### 阶段2：测试变更分析\n\n1. **识别测试变更范围**：\n   - 统计变更的测试文件数量和行数\n   - 识别是新增测试用例还是修改现有测试用例\n   - 确认变更涉及的测试函数或测试场景\n\n2. **关联代码变更分析**：\n   - 回顾或检索对应的代码变更（TL变更）\n   - 明确代码变更的核心功能点\n   - 列出需要测试的新增参数、新增逻辑或修改的行为\n\n3. **验证对应性**：\n   - 检查每个代码变更点是否有对应的测试用例\n   - 验证测试用例中的函数调用参数是否正确更新\n   - 确认测试数据的合理性（如参数值、边界值）\n\n### 阶段3：覆盖率评估\n\n1. **功能覆盖评估**：\n   - 正常路径：是否覆盖主要功能流程\n   - 边界条件：是否测试参数的边界值（0、-1、MAX、MIN）\n   - 异常场景：是否测试错误输入、NULL指针、无效参数\n   - 退化场景：是否测试空数据、未初始化等情况\n\n2. **场景合理性评估**：\n   - 测试场景是否符合实际使用情况\n   - 测试数据是否具有代表性\n   - 是否有冗余或重复的测试用例\n   - 测试用例的独立性（是否依赖执行顺序）\n\n3. **断言完整性评估**：\n   - 是否有明确的EXPECT/ASSERT断言\n   - 断言是否覆盖关键验证点\n   - 是否验证返回值、输出参数、副作用\n\n### 阶段4：问题标注与结论\n\n1. **生成行评论**（如发现问题）：\n   - 使用JSON格式保存行评论到 `/tmp/review_comments_[change-id].json`\n   - 每条评论包含：path（文件路径）、line（行号）、message（评审意见）\n   - 评审意见加前缀：【Jarvis Agent自主评审】\n\n2. **评估评审结论**：\n   - 如果测试覆盖充分且无问题：评分 +2（Looks good to me, approved）\n   - 如果测试覆盖基本充分但有小问题：评分 +1（Looks good to me, but need minor fixes）\n   - 如果测试覆盖不足或有重要问题：评分 0 或 -1（需要改进）\n\n3. **回退本地变更**：\n   - 执行 `git checkout -` 回退到原始分支\n   - 确保工作区干净\n\n## 实践指导\n\n### 测试覆盖率参考标准\n\n- **基础覆盖**：测试用例覆盖所有新增/修改的公开API\n- **良好覆盖**：在基础覆盖之上，增加边界条件和常见异常场景\n- **优秀覆盖**：在良好覆盖之上，增加极端异常场景、性能测试、并发测试\n\n### 常见问题检查点\n\n1. **参数变更**：\n   - 新增参数是否在所有测试点都传递正确\n   - 参数值是否使用硬编码常量（建议使用宏或配置）\n   - 是否缺少对不同参数值的测试\n\n2. **边界条件**：\n   - 数值边界：0、-1、MAX_INT、MIN_INT\n   - 字符串边界：空字符串、NULL、超长字符串\n   - 集合边界：空集合、单元素、最大容量\n\n3. **异常处理**：\n   - NULL指针检查\n   - 无效参数检查\n   - 资源耗尽场景（内存不足、句柄耗尽）\n\n### 评审意见示例\n\n**正面示例**：\n- ✅ 测试用例正确覆盖了新增的wSchIndex参数\n- ✅ 边界测试包含NULL指针和边界值\n- ✅ 测试场景设计合理，覆盖多种使用场景\n\n**需要改进**：\n- ⚠️ 所有测试用例中wSchIndex都使用固定值1，建议测试不同调度器索引\n- ⚠️ 缺少对参数越界情况的测试\n- ⚠️ 缺少对返回值验证的断言\n\n## 检查清单\n\n### 评审完成检查\n\n- [ ] Patch已成功应用\n- [ ] 已查看完整的变更内容\n- [ ] 已识别所有变更的测试文件和测试函数\n- [ ] 已验证测试用例与代码变更的对应性\n- [ ] 已评估测试覆盖率（正常、边界、异常）\n- [ ] 已检查测试场景的合理性\n- [ ] 已生成行评论（如有问题）\n- [ ] 已回退本地变更\n- [ ] 已保存评审结论到记忆系统\n\n### 评分标准\n\n- **+2（Approved）**：测试覆盖充分，场景设计合理，无问题\n- **+1（Minor issues）**：测试基本覆盖，场景基本合理，有小问题但不阻塞\n- **0（Needs work）**：测试覆盖不足，或场景设计不合理，需要补充\n- **-1（Blocked）**：测试严重不足，或有明显错误，必须修改\n\n## 输出模板\n\n```markdown\n## UTFT变更评审总结\n\n### 一、变更基本信息\n\n- **变更ID**: [change-id]\n- **项目**: [project-name]\n- **分支**: [branch-name]\n- **Patchset**: [patchset-number]\n- **变更标题**: [commit-subject]\n- **变更规模**: [+xx/-yy 行，涉及z个文件]\n\n### 二、测试变更分析\n\n**变更文件列表**：\n- [文件1路径]\n- [文件2路径]\n\n**核心变更内容**：\n- [测试用例变更描述]\n- [参数更新说明]\n- [场景覆盖说明]\n\n### 三、对应性验证\n\n与代码变更[对应的TL变更ID]对比分析：\n\n✅ **测试用例已正确更新**：\n- [具体说明]\n\n⚠️ **测试覆盖不足**：\n- [具体说明]\n\n### 四、测试覆盖率评估\n\n**功能覆盖**：\n- ✅ / ❌ 正常场景：[说明]\n- ✅ / ❌ 边界条件：[说明]\n- ✅ / ❌ 异常场景：[说明]\n\n**场景合理性**：\n- [评估测试场景是否符合实际使用]\n- [是否有冗余或缺失的测试]\n\n### 五、评审结论\n\n**总体评价**：[评分 +2/+1/0/-1]\n\n**主要优点**：\n- [列出优点]\n\n**改进建议**：\n- [列出建议]\n\n**行评论**：[已生成/无需生成，保存路径：/tmp/review_comments_xxx.json]\n```",
  "scope": "global"
}