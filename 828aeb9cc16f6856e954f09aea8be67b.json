{
  "problem_type": "Rust 全局状态测试失败修复方法论",
  "content": "问题重述：Rust项目中使用全局静态变量（如Lazy<Mutex<T>>）时，测试用例因断言失败而失败，需要分析并修复全局状态管理逻辑。\n\n可复用解决流程：\n\n1. **定位问题**  \n   - 运行具体测试：`cargo test module::tests::failing_test -- --nocapture`\n   - 检查错误信息，确认断言失败的具体位置\n   - 读取相关源代码，理解全局状态的使用方式\n\n2. **分析全局状态逻辑**  \n   - 检查全局变量的定义：`static VAR: Lazy<Mutex<T>> = Lazy::new(...)`\n   - 确认状态修改逻辑：查找push/insert/remove等操作\n   - 验证锁机制：确保正确使用lock()和unwrap()\n\n3. **检查测试环境**  \n   - 确认测试间状态隔离：是否提供了reset/cleanup函数\n   - 检查测试辅助函数：如reset_tmpfiles()是否清理全局状态\n   - 验证测试执行顺序：确保测试不依赖其他测试的状态\n\n4. **修复实现**  \n   - 如果缺少状态记录：在适当位置添加状态修改逻辑\n   - 如果状态未正确清理：完善reset函数或添加清理逻辑\n   - 如果并发问题：检查锁的使用和错误处理\n\n5. **验证修复**  \n   - 重新运行单个测试：`cargo test specific_test -- --nocapture`\n   - 确认测试通过：输出应显示\"test result: ok. 1 passed\"\n   - 运行完整测试套件：`cargo test` 确认无回归\n\n注意事项：\n- 全局状态测试需要特别注意测试间的隔离\n- 对于临时文件测试，测试后应清理文件避免磁盘堆积\n- 使用reset函数在测试开始前清理全局状态\n- NamedTempFile的keep()方法需要特别注意文件生命周期管理\n\n示例工具：\n- execute_script: 运行测试命令\n- read_code: 查看源代码和测试逻辑\n- save_memory: 记录修复经验"
}