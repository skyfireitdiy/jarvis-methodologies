{
  "problem_type": "扩展应用以从外部目录加载资源",
  "content": "### 问题重述\n当需要让一个应用程序（如Jarvis）能够从用户指定的外部目录加载特定资源（如方法论、工具、插件等），而不仅仅是从内置的默认目录加载时，应如何修改代码来实现这一功能。\n\n### 最优解决方案\n这是一个通用的代码修改流程，旨在通过添加新的配置项和修改资源加载逻辑来实现功能的扩展。\n\n1.  **定位相关代码**: 使用`execute_script`和`rg`工具，结合资源名称（例如 `methodology`, `tool`）和通用关键字（如 `config`, `load`, `dir`），来定位负责管理配置和加载资源的核心代码文件。\n    ```bash\n    # 示例命令\n    rg -l \"resource_name\" | xargs rg -l \"config\"\n    ```\n\n2.  **分析现有逻辑**: 使用`read_code`工具仔细阅读上一步定位到的文件，以理解：\n    - **配置侧**: 应用程序是如何定义、存储和读取配置项的（例如，通过一个全局字典、一个专门的`config.py`模块或环境变量）。\n    - **消费侧**: 资源加载代码是如何使用配置来找到并加载资源的。\n\n3.  **添加新配置项**: 在配置模块中，仿照现有配置项的实现方式，添加一个新的函数或变量，用于从配置源（如环境变量）中读取一个目录路径列表。该配置项应有合理的默认值（通常是一个空列表）。\n    ```python\n    # 示例：在 config.py 中添加新函数\n    def get_external_resource_dirs() -> List[str]:\n        \"\"\"\n        获取外部资源加载目录列表。\n        \"\"\"\n        return GLOBAL_CONFIG_DATA.get(\"JARVIS_EXTERNAL_RESOURCE_DIRS\", [])\n    ```\n\n4.  **修改加载逻辑**: 修改负责加载资源的函数，使其能够处理多个资源路径。\n    - 导入并调用上一步创建的新配置函数，获取外部目录列表。\n    - 将默认的内置资源目录与获取到的外部目录列表合并。建议使用`set`来确保路径的唯一性。\n    - 遍历合并后的所有目录，并从每个目录中加载资源文件。\n    - **(重要)** 考虑当不同目录中存在同名资源时的处理逻辑。一个常见的策略是打印警告并以后加载的为准，或者让用户配置优先级。\n\n5.  **增强代码健壮性**: 为新的加载逻辑添加必要的异常处理，以确保程序的稳定性。\n    - 在遍历目录前，检查每个路径是否存在并且确实是一个目录，如果不是，则打印警告并跳过。\n    - 在文件读取和解析过程中，使用`try...except`块捕获潜在的错误（如文件损坏、格式错误），并打印有意义的错误信息，而不是让整个应用崩溃。\n\n6.  **应用并验证**: 使用`edit_file`工具将上述所有修改一次性应用到代码库中。执行后，可以通过相关功能验证新配置是否生效。\n\n### 注意事项\n- **保持一致性**: 新增的配置和代码风格应与项目现有代码保持一致。\n- **文档更新**: 如果项目有相关文档，应及时更新，说明如何使用新的配置项。\n- **冲突处理**: 明确并实现资源冲突的处理策略（如重名资源），并在必要时通过日志告知用户。"
}