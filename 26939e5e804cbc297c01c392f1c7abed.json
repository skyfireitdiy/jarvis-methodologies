{
  "problem_type": "Rust单体文件模块化重构",
  "content": "# Rust单体文件模块化重构方法论\n\n## 适用场景\n- 单个Rust文件超过300行，包含多个不相关功能域\n- 需要按职责分离代码，遵循单一职责原则\n- 保持API兼容性，不破坏现有调用\n\n## 执行流程\n\n### 阶段1：分析与规划\n1. **功能识别**：将文件中的函数按职责分类\n   - 配置类（init_xxx, setup_xxx）\n   - 核心逻辑类（process_xxx, handle_xxx）\n   - 工具类（create_xxx, utils_xxx）\n   - 外部交互类（run_xxx, call_xxx）\n\n2. **模块设计**：创建目录结构\n   ```\n   src/\n   ├── mod.rs          # 重导出接口\n   ├── config.rs       # 配置相关\n   ├── engine.rs       # 核心逻辑\n   ├── linker.rs       # 外部交互\n   └── utils.rs        # 工具函数\n   ```\n\n### 阶段2：创建新模块\n1. **创建文件结构**：使用`rewrite_file`创建各模块\n2. **迁移函数**：按类别移动函数到新文件\n3. **接口重导出**：在mod.rs中使用pub use保持兼容性\n\n### 阶段3：重构主文件\n1. **更新导入**：从`use crate::xxx`改为`use crate::module::xxx`\n2. **简化主函数**：删除已迁移的辅助函数\n3. **添加测试入口**：如需要，创建`main_with_options`类测试函数\n\n### 阶段4：验证与清理\n1. **构建验证**：运行`cargo check`\n2. **测试验证**：运行`cargo test -- --nocapture`\n3. **清理旧文件**：删除已迁移的原始文件\n\n## 注意事项\n- 保持所有pub函数签名不变\n- 避免循环依赖\n- 确保测试覆盖率不降低\n- 分阶段提交，便于回滚\n\n## 工具组合\n- `rewrite_file`：创建新模块文件\n- `edit_file`：精确修改导入路径\n- `execute_script`：运行测试验证\n- `methodology`：记录复用经验"
}