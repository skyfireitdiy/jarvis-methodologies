{
  "problem_type": "Python模块开发完整流程",
  "content": "# Python模块开发完整流程\n\n## 规则简介\n\n本方法论提供了创建高质量Python模块的完整流程，从需求分析到最终验证。适用于需要实现完整功能模块的场景，强调轻量级实现、完善测试和代码质量保证。\n\n## 你必须遵守的原则\n\n### 原则1：轻量级优先\n\n**要求说明：**\n\n- **必须**：优先使用Python标准库（如ast, json, os, pathlib, threading）\n- **必须**：避免引入重量级第三方依赖\n- **必须**：使用简单数据结构（如JSON文件）进行持久化\n- **禁止**：过度设计，增加不必要的复杂性\n\n### 原则2：质量保证\n\n**要求说明：**\n\n- **必须**：所有公共API必须有完整的类型注解\n- **必须**：所有模块、类、公共方法必须有文档字符串\n- **必须**：代码风格通过ruff检查\n- **必须**：类型检查通过mypy\n- **必须**：安全检查通过bandit（低严重性问题可接受）\n- **禁止**：提交未通过质量检查的代码\n\n### 原则3：测试覆盖\n\n**要求说明：**\n\n- **必须**：编写全面的单元测试\n- **必须**：包含边界情况和异常处理测试\n- **必须**：测试覆盖率≥80%\n- **禁止**：跳过关键功能的测试\n\n### 原则4：安全性\n\n**要求说明：**\n\n- **必须**：线程安全：使用threading.Lock保护共享资源\n- **必须**：避免破坏性操作\n- **必须**：实现回滚或恢复机制\n- **禁止**：自动修改核心配置或删除用户数据\n\n## 你必须执行的操作\n\n### 阶段1：需求分析\n\n1. **明确功能需求**：\n   - 列出所有核心功能\n   - 明确功能边界和约束条件\n   - 定义验收标准\n\n2. **识别技术约束**：\n   - 确定技术栈版本（如Python 3.12）\n   - 识别性能要求\n   - 列出必须遵守的开发规范\n\n### 阶段2：架构设计\n\n1. **模块结构设计**：\n   - 规划目录结构（src/module_name/和tests/module_name/）\n   - 设计模块划分（单一职责原则）\n   - 定义模块入口（__init__.py）\n\n2. **接口设计**：\n   - 设计核心类和方法\n   - 定义公共API\n   - 设计数据结构（使用dataclass）\n\n3. **数据存储设计**：\n   - 选择轻量级存储方案（JSON文件优先）\n   - 设计数据模型\n   - 考虑线程安全\n\n### 阶段3：实现核心功能\n\n1. **创建目录结构**：\n   - 创建源码目录和测试目录\n   - 初始化__init__.py文件\n   - 添加模块文档\n\n2. **实现核心模块**：\n   - 实现主要功能类\n   - 使用标准库和轻量级依赖\n   - 添加类型注解和文档字符串\n   - 实现线程安全机制\n\n3. **完善模块接口**：\n   - 在__init__.py中导出公共API\n   - 确保导入路径正确\n   - 添加使用示例\n\n4. **代码质量检查**：\n   - 运行ruff检查并修复问题\n   - 运行mypy类型检查并修复问题\n   - 运行bandit安全检查\n\n### 阶段4：编写测试\n\n1. **创建测试文件**：\n   - 使用pytest框架\n   - 创建测试目录和__init__.py\n\n2. **编写测试用例**：\n   - 测试核心功能（正常流程）\n   - 测试边界情况（空值、极值等）\n   - 测试异常处理（错误输入、文件不存在等）\n   - 测试并发安全（如需要）\n\n3. **运行测试**：\n   - 确保所有测试通过\n   - 修复失败的测试\n   - 检查测试覆盖率≥80%\n\n### 阶段5：最终验证\n\n1. **代码质量验证**：\n   - 运行ruff检查：无错误\n   - 运行mypy检查：通过\n   - 运行bandit检查：通过（仅低严重性问题可接受）\n\n2. **功能验证**：\n   - 运行所有测试：全部通过\n   - 手动验证关键功能\n   - 检查模块导入无误\n\n3. **文档验证**：\n   - 检查文档字符串完整\n   - 验证使用示例正确\n   - 确认公共API清晰\n\n## 实践指导\n\n### 最佳实践\n\n1. **渐进式开发**：\n   - 先实现核心功能，再逐步完善\n   - 每个组件独立开发和测试\n   - 频繁提交，保持可回退\n\n2. **类型安全**：\n   - 使用typing模块提供类型提示\n   - 优先使用Optional明确可空类型\n   - 避免使用Any类型\n\n3. **线程安全**：\n   - 对共享资源使用threading.Lock\n   - 尽量减少锁的持有时间\n   - 使用上下文管理器（with语句）\n\n4. **错误处理**：\n   - 捕获具体异常而非裸except\n   - 提供有意义的错误信息\n   - 确保资源正确释放\n\n### 常见错误\n\n1. **导入路径错误**：\n   - 问题：使用错误的导入路径\n   - 解决：明确模块结构，使用相对导入或绝对导入\n\n2. **类型注解缺失**：\n   - 问题：mypy检查失败\n   - 解决：为所有公共API添加类型注解\n\n3. **测试不充分**：\n   - 问题：覆盖率不足80%\n   - 解决：补充边界测试和异常测试\n\n### 注意事项\n\n1. **依赖管理**：\n   - 检查是否真的需要第三方依赖\n   - 优先使用标准库\n   - 记录所有依赖到requirements.txt或pyproject.toml\n\n2. **性能考虑**：\n   - 避免不必要的I/O操作\n   - 使用缓存机制（如需要）\n   - 考虑并发性能\n\n3. **兼容性**：\n   - 考虑不同Python版本的兼容性\n   - 测试不同环境下的表现\n   - 处理文件路径差异（Windows/Linux）\n\n## 检查清单\n\n### 开发前检查\n\n- [ ] 功能需求明确\n- [ ] 技术约束清晰\n- [ ] 验收标准定义\n\n### 设计检查\n\n- [ ] 模块结构合理\n- [ ] 接口设计清晰\n- [ ] 数据模型完整\n\n### 实现检查\n\n- [ ] 核心功能实现\n- [ ] 类型注解完整\n- [ ] 文档字符串齐全\n- [ ] 线程安全保证\n\n### 测试检查\n\n- [ ] 测试用例完整\n- [ ] 覆盖率≥80%\n- [ ] 所有测试通过\n\n### 质量检查\n\n- [ ] ruff检查通过\n- [ ] mypy检查通过\n- [ ] bandit检查通过\n- [ ] 模块导入成功\n- [ ] 文档验证通过",
  "scope": "global"
}