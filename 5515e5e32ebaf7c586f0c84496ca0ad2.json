{
  "problem_type": "循环中断检测",
  "content": "在循环函数中添加中断检测的方法论\n\n**问题重述**\n在长时间运行的循环函数（如重试机制、轮询任务等）中，需要响应外部中断信号，以便用户可以随时取消操作。\n\n**可复用解决流程**\n\n1. **定位目标函数**\n   - 找到需要添加中断检测的循环函数\n   - 确认函数的返回类型和语义\n\n2. **检查中断机制**\n   - 确认项目的中断检测方式（如 get_interrupt()）\n   - 确认中断标志的类型（bool/int）\n\n3. **添加中断检测**\n   - 在循环开始处（while True: 后）添加检测\n   - 检测条件：if get_interrupt() > 0:\n   - 根据函数语义返回合适的值：\n     * 成功导向函数：返回 None 或表示失败/未完成的值\n     * 布尔导向函数：返回 False\n   - 不清除中断标志（不调用 set_interrupt(False)）\n   - 不重置内部状态（如重试计数器）\n\n4. **验证实现**\n   - 确认检测位置在 try 块之前\n   - 确认返回值符合函数语义\n   - 确认没有调用清除中断的函数\n\n**注意事项**\n- 中断检测应该在循环的最开始，避免进入不必要的执行逻辑\n- 返回值应保持函数原有的语义约定\n- 不清除中断标志是为了让上层调用者感知中断状态\n- 如果函数有重试计数器等内部状态，检测到中断时应保留这些状态\n\n**代码示例**\n```python\ndef while_success(func: Callable[[], Any]) -> Any:\n    while True:\n        # 检测中断信号，如果中断则直接返回（不清除中断标志）\n        if get_interrupt() > 0:\n            return None\n        try:\n            result = func()\n            # ... 正常逻辑\n```",
  "scope": "global"
}