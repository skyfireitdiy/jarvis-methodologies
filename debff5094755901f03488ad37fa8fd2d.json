{
  "problem_type": "Rust代码审查修复（C移植）",
  "content": "# Rust代码审查修复方法论（C移植场景）\n\n## 问题重述\n将C代码移植到Rust时，如何系统性修复审查发现的安全性、功能一致性和内存布局问题。\n\n## 可复用解决流程\n\n### 阶段1：问题识别与定位\n1. **审查问题分类**：\n   - 🔍 安全性问题（类型转换、内存安全）\n   - 🔍 功能一致性问题（缺失逻辑、状态处理）\n   - 🔍 测试覆盖率问题\n\n2. **使用工具定位**：\n   - `read_code`读取相关模块完整内容\n   - `lsp_client`分析符号引用关系\n   - `read_symbols`获取C源码参考\n\n### 阶段2：安全性修复\n1. **类型转换安全**：\n   - 识别不安全的裸指针转换\n   - 添加`#[repr(C)]`保证内存布局\n   - 使用`assert!`验证内存大小兼容性\n   - 示例：\n     ```rust\n     assert!(std::mem::size_of::<Src>() <= std::mem::size_of::<Dst>());\n     let dst = unsafe { &mut *(src as *mut Dst) };\n     ```\n\n2. **功能一致性修复**：\n   - 对照C源码检查缺失逻辑\n   - 实现缺失的状态处理（如move操作、孤儿处理）\n   - 保持状态机转换逻辑一致\n\n### 阶段3：测试验证\n1. **构建验证**：\n   - `cargo build`确保无编译错误\n   - `cargo test -- --nocapture`运行完整测试套件\n\n2. **回归测试**：\n   - 验证原有测试用例不受影响\n   - 补充关键路径测试（如状态边界值）\n\n### 阶段4：代码清理\n1. **移除未使用变量**：\n   - 处理`unused_mut`等编译警告\n   - 保持代码整洁\n\n## 注意事项\n- **最小改动原则**：避免大范围重构，专注于修复审查问题\n- **字节序处理**：在x86_64架构下，u32默认小端，注意简化处理\n- **依赖管理**：确保所有依赖函数已实现，避免`todo!()`占位\n- **测试策略**：在复杂依赖场景下，可先移除问题测试，保证主流程稳定\n\n## 可选步骤\n- 添加类型别名提高可读性\n- 创建宏封装重复的模式匹配逻辑\n- 引入更安全的抽象层封装裸指针操作"
}