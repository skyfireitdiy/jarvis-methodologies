{
  "problem_type": "C到Rust函数移植",
  "content": "## C到Rust函数移植方法论\n\n### 问题重述\n需要将C语言函数移植到Rust中，保持功能一致性，同时符合Rust语言特性和最佳实践。\n\n### 可复用解决流程\n\n#### 步骤1：需求分析\n- 使用 `read_code` 检查目标Rust文件当前状态\n- 对比C源码和Rust实现，识别缺失或未实现的函数\n- 确认函数签名和参数类型映射关系\n\n#### 步骤2：功能映射\n- 字符串路径 → 使用 `std::path::Path`\n- 字符串数组 → 使用 `Vec<String>`\n- malloc/free → 使用Rust所有权系统\n- 错误处理 → 使用 `Option`/`Result` 而非null指针\n\n#### 步骤3：实现移植\n- 使用 `rewrite_file` 实现完整函数\n- 保持C函数逻辑结构，转换为Rust语法\n- 添加必要的中文注释说明功能\n- 处理边界情况（路径不存在、编码问题等）\n\n#### 步骤4：验证测试\n- 运行 `cargo test -- --nocapture` 验证无回归\n- 检查编译错误和警告\n- 确认所有依赖函数已完整实现\n\n### 注意事项\n1. **路径处理**：使用 `Path.parent()` 和 `Path.join()` 替代C的dirname和字符串拼接\n2. **内存安全**：避免使用 `unwrap()`，优先使用模式匹配处理Option/Result\n3. **编码问题**：使用 `to_str()` 处理路径字符串转换，注意非UTF-8情况\n4. **最小改动**：仅修改必要文件，避免引入无关变化\n\n### 可选步骤\n- 对于复杂函数，可先创建临时测试验证功能\n- 如需要，可使用 `edit_file` 进行小范围精确修改\n- 记录移植过程中的特殊处理，供后续参考"
}