{
  "problem_type": "Rust项目依赖清理和构建配置标准化",
  "content": "||| \n## 问题重述\n当需要将Rust项目从路径依赖转为动态链接时，需要批量处理多个crate的：1)build.rs文件管理；2)Cargo.toml依赖清理；3)源文件extern crate声明添加。\n\n## 可复用解决流程\n\n### 阶段1：项目分析\n1. **识别目标crate**\n   ```bash\n   find <目录1> <目录2> -name \"Cargo.toml\" | sort\n   ```\n\n2. **分类处理**\n   - 已有build.rs的crate：仅清理依赖\n   - 无build.rs的crate：拷贝build.rs + 清理依赖\n\n3. **分析依赖模式**\n   ```bash\n   grep -r \"idf\\|idf-macro\" */Cargo.toml\n   ```\n\n### 阶段2：批量处理\n1. **build.rs处理**\n   ```bash\n   # 检查build.rs存在性\n   find <目录> -type f -name build.rs\n   \n   # 拷贝标准build.rs（仅当不存在时）\n   cp demo/build.rs <target_crate>/build.rs\n   ```\n\n2. **依赖清理**\n   ```bash\n   # 安全删除依赖（保留备份）\n   sed -i.bak '/idf.*=.*{.*path.*idf.*}/d' Cargo.toml\n   sed -i.bak '/idf-macro.*=.*{.*path.*idf-macro.*}/d' Cargo.toml\n   ```\n\n3. **extern crate添加**\n   ```bash\n   # 检查extern crate存在性\n   grep -n \"extern crate idf\" src/main.rs\n   \n   # 在文件开头添加（仅当不存在时）\n   sed -i '1iextern crate idf;' src/main.rs\n   ```\n\n### 阶段3：验证检查\n1. **语法验证**\n   ```bash\n   cargo check --manifest-path <path>/Cargo.toml\n   ```\n\n2. **依赖验证**\n   ```bash\n   sed -n '/\\[dependencies\\]/,/\\[/p' Cargo.toml | grep -i \"idf\" || echo \"清理完成\"\n   ```\n\n3. **符号验证**\n   ```bash\n   grep -n \"extern crate idf\" src/main.rs\n   ```\n\n## 注意事项\n- 始终保留文件备份（.bak文件）\n- 编译错误是预期内的，不表示清理失败\n- 元数据字段中的idf关键词不影响清理结果\n- 使用精确文本匹配，避免误删其他依赖\n\n## 可选步骤\n- 批量验证：使用循环处理所有crate\n- 生成报告：记录每个crate的处理状态\n- 自动化脚本：将流程封装为bash/python脚本\n|||"
}