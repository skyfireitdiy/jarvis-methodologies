{
  "problem_type": "Rust原子操作测试失败诊断",
  "content": "## 问题重述\n当Rust代码中使用原子操作（如fetch_add/fetch_sub）时，测试失败可能源于对返回值含义的误解。原子操作返回操作前的值，但业务逻辑可能需要操作后的值。\n\n## 可复用解决流程\n1. **识别问题模式**\n   - 测试断言失败但逻辑看似正确\n   - 涉及Atomic*类型的fetch_*操作\n\n2. **验证原子操作行为**\n   - 使用`cargo test -- --nocapture`查看实际失败值\n   - 确认fetch_*操作返回的是操作前的值\n\n3. **对比期望值与实际值**\n   - 如果实际值 = 期望值 + 1，说明应该返回操作前值\n   - 如果实际值 = 期望值 - 1，说明应该返回操作后值\n\n4. **实施修复**\n   - 需要操作前值：直接使用fetch_*返回值\n   - 需要操作后值：使用fetch_*返回值 ± 操作数\n\n5. **验证修复**\n   - 重新运行测试确保通过\n   - 检查边界条件（如0、MAX值）\n\n## 注意事项\n- fetch_sub返回旧值，新值 = 返回值 - 操作数\n- fetch_add返回旧值，新值 = 返回值 + 操作数\n- 测试用例设计时要明确验证的是原子操作行为还是业务逻辑\n- 考虑使用wrapping_add/wrapping_sub处理溢出\n\n## 可选步骤\n- 添加wrapping边界测试\n- 验证Ordering参数是否合适\n- 检查是否有并发访问问题"
}