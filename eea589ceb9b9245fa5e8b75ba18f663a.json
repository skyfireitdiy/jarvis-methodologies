{
  "problem_type": "Rust Unsafe代码到安全代码重构",
  "content": "问题重述：将C代码移植到Rust时，经常会产生包含unsafe块和裸指针操作的代码。需要将这类代码重构为纯安全Rust代码，同时保持与原始C实现的行为完全一致。\n\n可复用解决流程：\n1. 分析阶段\n   - 使用read_code定位unsafe块和裸指针转换\n   - 识别指针操作模式：链表遍历、数组访问、指针算术等\n   - 绘制数据流图，理解引用关系\n\n2. 设计阶段\n   - 将*mut T转换为&mut T或&[T]\n   - 处理生命周期问题，可能需要引入显式生命周期参数\n   - 设计安全的链表遍历模式（使用Option<&mut T>）\n\n3. 实现阶段\n   - 逐步替换unsafe块为安全代码\n   - 消除所有裸指针转换\n   - 保持原有算法逻辑不变\n\n4. 验证阶段\n   - 使用execute_script运行cargo test确保功能一致性\n   - 检查是否完全移除unsafe关键字\n   - 验证边界条件处理\n\n注意事项：\n- 链表处理是最大难点，需要仔细处理&mut引用的可变性\n- 可能需要引入辅助函数来避免多重可变借用\n- 保持测试用例不变以确保行为一致性\n- 注意处理边界情况（如EOF、空链表）\n\n可选步骤：\n- 如果性能成为问题，可考虑使用unsafe但封装在安全API中\n- 对于复杂场景，可分阶段重构，先部分安全化\n- 使用Clippy检查潜在的安全问题"
}