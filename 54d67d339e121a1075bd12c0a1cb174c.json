{
  "problem_type": "工具访问agent实例",
  "content": "# 工具访问agent实例的最佳实践\n\n## 问题描述\n在工具开发中，有时需要访问当前运行的agent实例，例如：\n- 读取或修改agent的属性（如pin_content、user_data等）\n- 调用agent的方法\n- 获取agent的配置或状态\n\n## 可复用解决流程\n\n### 1. 理解工具协议版本\nJarvis工具支持v1.0和v2.0两个协议版本，agent传递方式不同：\n- **v1.0协议**：agent通过arguments字典注入\n- **v2.0协议**：agent作为独立的第二个参数传递\n\n### 2. 在工具中获取agent实例\n\n**v1.0协议（默认）**：\n```python\ndef execute(self, args: Dict[str, Any]) -> Dict[str, Any]:\n    # 从arguments中获取agent\n    agent = args.get(\"agent\")\n        # 使用agent...\n```\n\n**v2.0协议**：\n```python\ndef execute(self, args: Dict[str, Any], agent: Any = None) -> Dict[str, Any]:\n    # agent作为独立参数传入\n    if agent:\n        # 使用agent...\n```\n\n### 3. 将agent传递给内部方法\n如果工具有内部方法需要使用agent，通过参数传递：\n\n```python\ndef _internal_method(self, data: Dict[str, Any], agent: Any = None):\n    if agent and hasattr(agent, 'some_property'):\n        # 安全地使用agent\n```\n\n### 4. 安全使用agent\n```python\n# 检查agent是否存在\nif agent is None:\n    # 处理agent不存在的情况\n    pass\n\n# 检查agent是否有所需属性\nif not hasattr(agent, 'pin_content'):\n    # 处理属性不存在的情况\n    pass\n\n# 安全地修改agent属性\ntry:\n    if agent.pin_content:\n        agent.pin_content += \"\\n\" + new_content\n    else:\n        agent.pin_content = new_content\nexcept Exception as e:\n    # 处理异常\n    pass\n```\n\n## 注意事项\n\n1. **兼容性**：优先使用v1.0协议（默认），确保向后兼容\n2. **空值检查**：始终检查agent是否为None\n3. **属性存在性**：使用hasattr()检查属性是否存在\n4. **异常处理**：使用try-except包裹可能失败的操作\n5. **文档说明**：在工具描述中说明是否需要访问agent\n\n## 可选步骤\n\n如果工具确实需要频繁访问agent，可以考虑：\n- 在__init__中初始化agent相关逻辑\n- 创建辅助方法简化agent访问\n- 在工具描述中明确说明对agent的依赖",
  "scope": "global"
}