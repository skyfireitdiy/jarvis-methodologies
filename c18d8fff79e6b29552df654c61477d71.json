{
  "problem_type": "测试间状态污染修复",
  "content": "## 问题重述\n测试套件中出现偶发性失败，表现为：\n- 单独运行测试通过\n- 批量运行测试失败\n- 错误位置在不同测试间切换\n\n## 可复用解决流程\n\n### 步骤1：定位问题\n```bash\n# 运行完整测试套件\ncargo test -- --nocapture\n\n# 识别失败测试\ncargo test <失败测试名> -- --nocapture\n```\n\n### 步骤2：分析状态污染源\n1. 检查全局静态变量\n2. 检查临时文件/目录残留\n3. 检查缓存/全局配置被修改\n\n### 步骤3：修复策略\n**对于全局状态：**\n```rust\n// 错误做法：仅清空内容\npub fn clear_state() {\n    let mut state = GLOBAL_STATE.lock().unwrap();\n    state.clear(); // 可能保留容量和内存布局\n}\n\n// 正确做法：完全重新初始化\npub fn clear_state() {\n    let mut state = GLOBAL_STATE.lock().unwrap();\n    *state = Vec::new(); // 完全新实例\n}\n```\n\n**对于临时资源：**\n- 使用 RAII 模式自动清理\n- 在测试 teardown 中显式清理\n\n### 步骤4：验证修复\n1. 多次运行测试：重复3-5次\n2. 并行运行：使用 `cargo test -- --test-threads=8`\n3. 检查回归：确保其他测试不受影响\n\n### 注意事项\n- 修复后必须验证所有测试通过\n- 不要仅修复当前失败的测试\n- 考虑添加测试间隔离机制\n- 对于复杂状态，考虑使用测试专用的初始化/清理函数"
}