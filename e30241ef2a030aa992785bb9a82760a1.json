{
  "problem_type": "Rust测试并发状态污染诊断",
  "content": "问题重述：Rust测试在并行执行时，多个测试用例同时访问和修改全局状态变量，导致竞态条件和测试失败。\n\n可复用解决流程：\n1. **问题识别阶段**\n   - 查看测试失败模式：是否多个测试同时失败\n   - 检查失败信息：是否涉及全局变量或共享状态\n   - 使用execute_script工具运行单个测试验证\n\n2. **并发测试诊断**\n   - 使用命令：`cargo test test_name -- --nocapture` 验证单个测试\n   - 使用命令：`cargo test -- --test-threads=1 --nocapture` 单线程运行所有测试\n   - 对比结果差异确认状态污染\n\n3. **根因分析**\n   - 检查测试间共享的全局变量（如原子变量、Mutex等）\n   - 验证reset/state清理函数是否正确实现\n   - 确认测试隔离机制是否有效\n\n4. **解决方案选择**\n   - 方案A：修复状态隔离（添加正确的reset函数）\n   - 方案B：使用单线程测试（适用于状态不可隔离的场景）\n   - 方案C：重构代码减少全局状态依赖\n\n注意事项：\n- 单线程测试会显著增加测试时间\n- 确保所有测试都有适当的cleanup机制\n- 考虑使用setup/teardown模式确保测试独立性\n- 对于不可变状态，优先考虑线程安全的数据结构\n\n可选步骤：\n- 在CI/CD环境中设置RUST_TEST_THREADS=1环境变量\n- 添加测试隔离的lint规则\n- 使用proptest或quickcheck进行状态一致性验证"
}