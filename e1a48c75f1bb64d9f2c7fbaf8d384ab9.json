{
  "problem_type": "C到Rust编译器转译修复",
  "content": "## C到Rust编译器转译修复方法论\n\n### 适用场景\n从C源码转译为Rust实现时，修复功能差异和接口不匹配问题。\n\n### 核心解决流程\n\n#### 1. 差异识别阶段\n- 使用review工具分析C和Rust实现的语义差异\n- 识别\"严重问题\" > \"功能一致性问题\" > \"结构性问题\"的优先级\n- 标记所有`todo!`/`unimplemented!`占位符\n\n#### 2. 模块化重构\n- **工具函数**：迁移到`common/util.rs`，保持C标准库行为\n- **类型系统**：在`ty/mod.rs`中实现类型相关检查函数\n- **代码生成**：确保`gen_stmt`等核心函数完整实现\n\n#### 3. 签名对齐清单\n| C类型 | Rust等价 | 注意事项 |\n|-------|----------|----------|\n| `int` | `i32` | 避免使用Rust的bool |\n| `char*` | `&str` | 注意空字符串处理 |\n| `void*` | `*const u8` | 指针运算需要unsafe |\n| `size_t` | `usize` | 平台相关的无符号整数 |\n\n#### 4. 测试验证流程\n1. 运行`cargo test -- --nocapture`获取完整测试报告\n2. 优先修复导致panic的测试\n3. 补充边界条件测试用例\n4. 验证所有测试通过且无内存泄漏\n\n#### 5. 回退机制\n- 每个修复步骤提交一次git\n- 使用`git log --oneline`跟踪修复历史\n- 发现问题立即`git checkout`回退\n\n### 常见陷阱\n- 直接复制C的指针操作到Rust\n- 忽略Rust的所有权系统\n- 混淆C的整数返回值与Rust的bool\n- 未处理变参函数的va_list映射\n\n### 工具链\n- `lsp_client`：快速定位符号定义\n- `read_code`：查看C源码参考实现\n- `edit_file`：最小化修改范围\n- `execute_script`：运行测试验证"
}