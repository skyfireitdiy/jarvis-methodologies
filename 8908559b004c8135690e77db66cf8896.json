{
  "problem_type": "Shell脚本语法错误诊断",
  "content": "## 问题重述\nShell脚本出现语法错误，需要快速定位和修复问题（如if/fi不匹配、未闭合的引号、变量展开错误等）。\n\n## 可复用解决流程\n\n### 1. 基础语法检查\n```bash\nbash -n script.sh\n```\n- 如果输出 \"syntax error: unexpected end of file\"，说明存在未闭合的结构（如if未配对fi）\n- 如果输出其他错误信息，指向具体的语法问题\n\n### 2. Shell静态分析\n```bash\nshellcheck script.sh\n```\n- 获取详细的错误代码和建议\n- 常见错误：\n  - SC1046/SC1047: if/fi不匹配\n  - SC1087: 变量展开问题（如$VAR[1]需要写成${VAR}[1]）\n\n### 3. 结构匹配检查\n```bash\n# 统计if和fi数量\ngrep -c '^\\s*if ' script.sh\ngrep -c '^\\s*fi$' script.sh\n```\n- 两个数量应该相等\n- 不等说明存在未配对的if语句\n\n### 4. 定位缺失的fi\n```bash\n# 查看所有if语句及行号\ngrep -n '^\\s*if ' script.sh\n\n# 查看所有fi语句及行号\ngrep -n '^\\s*fi$' script.sh\n```\n\n### 5. 分析嵌套结构\n```bash\n# 显示指定行范围的缩进结构\nsed -n 'START,ENDp' script.sh | sed 's/\\t/<TAB>/g; s/ /<SPACE>/g' | nl -v START\n```\n- 使用可视化缩进工具分析嵌套层级\n- 确认每个if都有对应的fi\n\n### 6. 验证修复\n```bash\nbash -n script.sh && echo \"✓ 语法检查通过\"\nshellcheck script.sh && echo \"✓ Shellcheck通过\"\n```\n\n## 注意事项\n1. Bash语法检查只检测语法错误，不检测逻辑错误\n2. Shellcheck的警告（SC1087等）有时可以忽略（如Python包的extra依赖语法）\n3. 修复时注意保持原文件的缩进风格\n4. 复杂结构建议先创建最小测试用例验证修复方案\n\n## 可选步骤\n- 对于大型脚本，可以分段测试：提取可疑代码块到临时文件单独验证\n- 使用 `set -x` 调试模式运行脚本，观察执行流程",
  "scope": "global"
}