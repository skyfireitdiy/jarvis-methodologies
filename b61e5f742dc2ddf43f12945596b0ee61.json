{
  "problem_type": "C静态变量函数Rust移植",
  "content": "## C静态变量函数到Rust移植方法论\n\n### 问题重述\n将C语言中包含static局部变量的函数移植到Rust，保持相同的行为语义。\n\n### 可复用解决流程\n\n1. **分析阶段**\n   - 使用read_code读取原始C代码，确认static变量的初始值和修改逻辑\n   - 确定变量类型和生命周期需求\n\n2. **TDD设计阶段**\n   - 先设计测试用例：验证递增/状态保持行为，而非具体初始值\n   - 考虑测试间状态隔离问题\n\n3. **实现阶段**\n   - **模式选择**：\n     * 单线程：`static mut` + unsafe块（最接近C语义）\n     * 多线程：`std::sync::atomic::AtomicUsize` + `fetch_add`\n   - **实现模板**：\n     ```rust\n     pub fn function_name() -> return_type {\n         static mut VAR: Type = initial_value;\n         unsafe {\n             let current = VAR;\n             VAR = modify_operation(current);\n             current\n     }\n     }\n     ```\n\n4. **测试验证阶段**\n   - 运行cargo test验证功能正确性\n   - 使用相对断言而非绝对值断言（验证递增关系）\n\n5. **重构阶段**\n   - 检查代码风格（中文注释、无通配导入）\n   - 考虑线程安全需求（如需）\n\n### 注意事项\n- Rust测试中静态变量状态会跨测试保持，避免依赖特定初始值的测试\n- unsafe块的使用需要谨慎评估安全性\n- 考虑使用`#[test]`属性确保测试代码不会污染正式代码\n\n### 可选步骤\n- 如需线程安全：替换为`Atomic*`类型\n- 如需复杂初始化：使用`once_cell::sync::Lazy`"
}