{
  "problem_type": "安全删除过时函数",
  "content": "安全删除过时函数的重构方法论\n\n问题重述：\n需要删除一个已过时的函数，并将其所有调用处迁移到新的实现方式。这个过程必须确保不破坏现有功能，且所有调用点都被正确更新。\n\n可复用解决流程：\n\n1. 研究阶段（RESEARCH）\n   - 使用 rg 搜索函数定义：rg -n 'def function_name' src/ --type py\n   - 使用 rg 搜索所有调用处：rg -n 'function_name' src/ --type py\n   - 读取函数定义，理解其功能和参数\n   - 读取每个调用处，分析上下文和返回值使用方式\n   - 确定替代方案（新函数名、不同的逻辑等）\n\n2. 计划阶段（PLAN）\n   - 创建任务列表（task_list_manager），按依赖关系拆分任务：\n     a. 修改导入语句（如需要）\n     b. 修改每个调用处的代码（可能包括变量重命名）\n     c. 删除函数定义\n     d. 全局验证\n   - 明确每个任务的约束条件和验证标准\n\n3. 执行阶段（EXECUTE）\n   - 按依赖顺序逐个执行任务\n   - 每次修改后等待验证结果（静态扫描等）\n   - 如果变量名需要更改，确保所有引用该变量的地方都同步更新\n\n4. 验证阶段（REVIEW）\n   - 使用 rg 全局搜索确认旧函数名无残留\n   - 使用 read_code 检查关键修改点\n   - 运行静态扫描（ruff、mypy）确保无错误\n   - 检查是否有其他文件需要修改（测试文件、文档等）\n\n注意事项：\n\n1. 必须先完成所有调用处的修改，再删除函数定义\n2. 如果涉及单位转换（如字符数→token数），需要：\n   - 更新变量名以准确反映单位\n   - 更新注释说明转换逻辑\n   - 确保计算公式正确\n3. 保持代码风格一致（缩进、注释格式等）\n4. 每个步骤都应可回退（小步提交）\n5. 静态扫描的错误可能是预期的（如中间步骤），需判断是否需要立即修复\n\n可选步骤：\n\n1. 如果改动较大，可以在计划阶段添加备份步骤\n2. 如果涉及多个模块，可以按模块拆分任务\n3. 如果有测试覆盖，修改后运行相关测试\n4. 更新相关文档和注释\n\n常用工具：\n- rg/execute_script：搜索代码\n- read_code：读取代码内容\n- edit_file：精确修改代码\n- task_list_manager：管理复杂任务\n- save_memory：保存重构决策和经验",
  "scope": "global"
}