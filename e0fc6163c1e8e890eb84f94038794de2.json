{
  "problem_type": "Rust动态库debug_assertions兼容性验证",
  "content": "# Rust动态库debug_assertions兼容性验证方法论\n\n## 问题重述\n验证Rust动态库在上下游debug_assertions配置不一致时的兼容性，确保所有Rust语法元素和复杂特性在不同配置组合下正常工作。\n\n## 可复用解决流程\n\n### 阶段1：环境准备\n1. **创建专用测试项目结构**\n   ```\n   scenario_test/\n   ├── dylib_package/          # 上游动态库\n   ├── use_dylib_exe/          # 下游验证程序\n   ├── test_configs/           # 4种配置文件\n   └── debug_test_results/     # 结果目录\n   ```\n\n2. **准备4种测试配置文件**\n   - Cargo.upstream_debug.toml：上游debug模式（debug-assertions=true）\n   - Cargo.upstream_release.toml：上游release模式（debug-assertions=false）\n   - Cargo.downstream_debug.toml：下游debug模式（debug-assertions=true）\n   - Cargo.downstream_release.toml：下游release模式（debug-assertions=false）\n\n### 阶段2：上游动态库改造\n1. **全面添加debug_assert!验证**\n   - 基本函数：参数范围、溢出检测\n   - 泛型函数：类型边界验证\n   - 复杂结构体：字段值范围、状态一致性\n   - 数学运算：除零、NaN检查\n   - 集合操作：长度边界检查\n   - 并发原语：状态检查、计数器保护\n\n2. **创建专用测试接口**\n   - test_assertion_trigger(value): 测试断言触发\n   - test_boundary_condition(size): 测试边界条件\n   - test_complex_assertion(data): 测试复杂类型断言\n\n### 阶段3：测试执行\n1. **使用自动化测试脚本**\n   ```bash\n   ./run_debug_test.sh  # 一键执行4种组合测试\n   ```\n\n2. **验证维度确保覆盖**\n   - ✅ 断言触发行为验证\n   - ✅ 接口兼容性验证\n   - ✅ 性能表现对比\n   - ✅ 错误处理机制验证\n   - ✅ 边界条件处理验证\n   - ✅ 复杂特性兼容性验证\n\n### 阶段4：结果分析\n1. **检查验证报告**\n   - 查看debug_test_results/verification_report_*.md\n   - 分析4种组合的验证结果\n\n2. **验证关键结论**\n   - 断言行为独立性：上游配置决定debug_assert!行为\n   - 接口透明性：下游对上游配置完全透明\n   - 性能优化：release模式性能显著提升\n\n## 注意事项\n- debug_assert!行为仅由上游编译配置决定，不受下游配置影响\n- 实际项目中可以放心使用不同debug_assertions配置的上下游组合\n- 测试数据需覆盖正常参数、边界参数、异常参数三个维度\n- 所有验证必须基于100%真实测试，不得推测\n\n## 可选步骤\n1. **扩展验证**：添加性能基准测试对比\n2. **CI集成**：将测试集成到持续集成流程\n3. **跨平台**：在Windows/macOS上验证相同行为\n4. **更多场景**：扩展到其他条件编译标志的兼容性测试"
}