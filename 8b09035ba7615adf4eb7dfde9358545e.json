{
  "problem_type": "bzip2并行解压优化",
  "content": "问题重述：将基于串行流式API的bzip2解压改为并行预解压，提升性能同时保持API兼容性\n\n可复用解决流程：\n1. **需求分析阶段**\n   - 识别现有串行API：BZ2_bzReadOpen → BZ2_bzRead → BZ2_bzReadClose\n   - 确定性能瓶颈：流式解压无法并行利用CPU\n   - 设定约束：保持API签名不变，保持行为兼容性\n\n2. **架构设计阶段**\n   - 扩展内部结构体：增加decompressed_data、read_pos、use_parallel字段\n   - 设计双模式：并行预解压模式 + 串行流式模式\n   - 设置安全限制：文件大小阈值(500MB)防止内存溢出\n\n3. **实现阶段**\n   - BZ2_bzReadOpen：读取整个文件，使用并行解压算法预处理\n   - BZ2_bzRead：根据use_parallel标志选择读取路径\n   - 错误回退：并行解压失败时自动切换到串行模式\n\n4. **验证阶段**\n   - 功能测试：确保所有测试通过\n   - 性能测试：运行bench_three_way.sh验证解压速度提升\n   - 兼容性测试：验证API行为一致性\n\n注意事项：\n- 必须处理文件读取失败、解压失败等边界情况\n- 保持所有调试日志，不要删除现有日志\n- 对大文件设置合理的内存限制\n- 确保串行模式逻辑完整保留作为回退\n\n可选步骤：\n- 动态调整并行度基于CPU核心数\n- 支持配置文件大小阈值\n- 添加性能监控和统计信息"
}