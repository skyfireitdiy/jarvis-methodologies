{
  "problem_type": "C到Rust TDD转换方法论",
  "content": "## C到Rust TDD转换方法论\n\n### 问题重述\n将C语言函数转换为Rust实现，要求使用测试驱动开发(TDD)方法，确保语义等价且符合Rust最佳实践。\n\n### 可复用解决流程\n\n#### 阶段1：分析准备\n1. **符号信息获取**\n   - 使用read_symbols获取C函数和依赖类型定义\n   - 定位原C文件路径和函数签名\n\n2. **类型映射分析**\n   - 枚举类型：C enum → Rust enum\n   - 结构体：C struct → Rust struct\n   - 指针：C指针 → Rust Box/引用\n   - 基本类型：int → i32, size_t → usize等\n\n#### 阶段2：Red阶段（测试先行）\n1. **测试模块创建**\n   - 在目标Rust文件中添加`#[cfg(test)] mod tests`\n   - 基于C函数行为设计测试用例：\n     - 正常输入测试\n     - 零值/空值测试\n     - 边界值测试\n     - 全类型覆盖测试（针对枚举）\n\n2. **测试用例模板**\n   ```rust\n   #[test]\n   fn test_basic_functionality() {\n       let result = target_function(normal_input);\n       assert_eq!(result.expected_field, expected_value);\n   }\n   ```\n\n#### 阶段3：Green阶段（实现）\n1. **类型定义**\n   - 先定义必要的enum/struct类型\n   - 使用Rust原生类型（usize, bool等）\n   - 添加Debug/Clone/Copy等必要trait\n\n2. **函数实现**\n   - 内存管理：calloc → Box::new，free → 自动释放\n   - 函数签名：保持参数顺序和含义，类型按Rust规范\n   - 错误处理：C的NULL返回 → Rust的Option/Result\n\n#### 阶段4：验证与重构\n1. **测试运行**：cargo test验证所有测试通过\n2. **代码质量检查**：\n   - 中文注释\n   - 文档注释\n   - 代码格式化\n   - 消除编译警告\n\n### 注意事项\n- 关键字冲突：使用r#前缀处理Rust关键字（如type → r#type）\n- 模块结构：避免重复模块声明\n- 测试覆盖率：至少包含正常、边界、空值三种情况\n- 类型安全：优先使用Rust强类型系统\n\n### 可选步骤\n- 复杂类型：逐步添加更多字段而非一次完整映射\n- 性能优化：后续可替换为更高效的内存分配策略\n- 集成测试：转译完成后在C项目中验证兼容性"
}