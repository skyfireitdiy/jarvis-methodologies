{
  "problem_type": "C函数输出重定向修复",
  "content": "## C函数输出重定向修复方法论\n\n### 问题描述\nC代码中常见使用全局输出文件指针(FILE *output_file)或printf系列函数的输出方式，在Rust转译时需要改为接受Write参数的函数调用。\n\n### 可复用解决流程\n\n1. **识别输出模式**\n   - 使用read_code检查原C函数输出方式\n   - 识别是否使用全局变量、宏、或直接输出\n\n2. **修改函数签名**\n   - 从`fn func(args) -> String/Result<String>`改为`fn func(args, out: &mut dyn Write) -> io::Result<()>`\n   - 移除不必要的中间字符串构建\n\n3. **实现迁移**\n   - 将printf/println改为writeln!(out, ...)\n   - 处理错误类型转换：Box<dyn Error> -> io::Error\n   - 移除OutputBuilder等中间结构\n\n4. **依赖更新**\n   - 检查调用链路上的所有函数\n   - 逐级更新签名，确保类型匹配\n   - 处理错误传播的兼容性问题\n\n5. **测试验证**\n   - 创建测试用例验证输出正确性\n   - 测试空输入、单文件、多文件场景\n   - 验证输出格式与C实现一致\n\n### 注意事项\n- 保留必要的深拷贝，不可为了性能牺牲正确性\n- 注意错误类型转换，必要时使用map_err\n- 保持函数语义不变，仅改变输出方式\n- 测试要覆盖边界情况\n\n### 可选步骤\n- 如需要，可创建辅助函数处理格式转换\n- 对于复杂输出，可考虑使用模板引擎\n- 可添加缓冲机制优化性能"
}