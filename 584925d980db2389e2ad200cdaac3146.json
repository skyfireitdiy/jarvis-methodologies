{
  "problem_type": "处理安全扫描报告中的IO操作问题",
  "content": "# 处理安全扫描报告中IO操作问题的通用方法论\n\n## 问题重述\n安全扫描报告常发现以下类型的问题：\n- 文件读写操作返回值未检查（fread/fwrite）\n- 路径遍历漏洞（文件名验证不完整）\n- 系统调用返回值未检查（close/fclose等）\n- 资源未正确清理导致的泄漏\n\n## 可复用解决流程\n\n### 步骤1：定位问题代码\n- 使用read_code工具读取报告指出的具体文件和行号\n- 验证问题上下文和边界条件\n\n### 步骤2：路径遍历防护\n- **检查函数**：IsValidFileName或类似名称\n- **修复模式**：\n  1. 现有正则表达式验证格式\n  2. 添加`find(\\\"..\\\") != std::string::npos`检查\n  3. 返回false拒绝包含\"..\"的路径\n\n### 步骤3：fread/fwrite返回值检查\n- **检查点**：所有fread/fwrite调用\n- **修复模式**：\n  ```cpp\n  if (fread(buffer, size, count, file) != count) {\n      std::cerr << \\\"Error reading file: \\\" << strerror(errno) << std::endl;\n      fclose(file);  // 清理资源\n      return -1;     // 或continue/break\n  }\n  ```\n\n### 步骤4：close系统调用检查\n- **检查点**：所有close、fclose调用\n- **修复模式**：\n  - **普通场景**：检查返回值并记录日志\n  ```cpp\n  if (close(fd) != 0) {\n      std::cerr << \\\"Failed to close fd: \\\" << errno << std::endl;\n  }\n  ```\n  - **信号处理函数**：仅检查，不执行复杂操作\n  ```cpp\n  if (close(fd) != 0) {\n      // 信号处理函数中不宜执行复杂操作\n  }\n  ```\n\n### 步骤5：验证修改\n1. 修改符合最小化原则，不改变API签名\n2. 保持向后兼容性\n3. 遵循项目错误处理惯例\n4. 确保代码能够编译\n\n## 注意事项\n- **资源清理顺序**：先检查错误→清理资源→日志记录→返回\n- **日志级别**：使用std::cerr或项目指定的错误日志机制\n- **异常安全**：确保在发生错误时所有资源都被正确释放\n- **信号处理**：保持信号处理函数简洁，避免复杂操作\n\n## 可选步骤\n- 如需要批量检查，可以创建自动化脚本扫描特定模式\n- 对于大型项目，可以按模块分批处理\n- 与项目维护者确认错误处理风格的一致性"
}