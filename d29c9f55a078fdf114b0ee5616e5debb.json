{
  "problem_type": "C到Rust编译器代码移植",
  "content": "# C到Rust编译器代码移植方法论\n\n## 问题重述\n将C语言实现的编译器（如chibicc）转译为Rust实现，保持语义一致且通过所有测试。\n\n## 可复用解决流程\n\n### 阶段1：环境准备\n1. 建立项目结构：使用`cargo new --lib translator_name`\n2. 分析C代码：使用`read_symbols`获取C符号表\n3. 确认依赖：检查C标准库依赖和系统调用\n\n### 阶段2：核心数据结构转译\n1. **结构体转译**：\n   - C的`struct` → Rust的`struct`或`enum`\n   - 指针字段 → `Box<T>`、`Rc<T>`或原始指针\n   - 数组 → `Vec<T>`或固定大小数组\n\n2. **函数签名转译**：\n   - `void*` → `*mut T`或`usize`\n   - `char*` → `&str`或`CString`\n   - 可变参数 → Rust的`...`或`Vec<T>`\n\n### 阶段3：核心逻辑实现\n1. **内存管理**：\n   - 使用`Box::new()`代替`malloc`\n   - 使用`Option<Box<T>>`代替空指针\n   - 避免`unsafe`块除非必要\n\n2. **错误处理**：\n   - C的`assert` → Rust的`assert!`\n   - C的`panic` → Rust的`panic!`或`Result`\n\n### 阶段4：测试验证\n1. **单元测试**：\n   - 为每个转译函数创建测试\n   - 使用`setup_context()`隔离测试状态\n   - 验证输出格式匹配C实现\n\n2. **集成测试**：\n   - 运行`cargo test -- --nocapture`\n   - 验证所有测试通过\n   - 处理内存错误和段错误\n\n### 阶段5：优化与清理\n1. **代码质量**：\n   - 消除所有编译警告\n   - 运行`cargo clippy -- -D warnings`\n   - 添加中文注释\n\n2. **性能优化**：\n   - 避免不必要的克隆\n   - 使用引用而非所有权转移\n   - 缓存计算结果\n\n## 注意事项\n- 保持最小改动：只修复实际失败的部分\n- 内存安全优先：使用Rust的安全特性\n- 测试驱动：每个修改都通过测试验证\n- 逐步推进：一次只处理一个函数或模块\n\n## 可选步骤\n- 添加性能基准测试\n- 实现增量编译支持\n- 添加调试符号支持"
}