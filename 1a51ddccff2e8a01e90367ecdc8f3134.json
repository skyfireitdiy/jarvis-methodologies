{
  "problem_type": "Rust测试并发问题修复",
  "content": "# Rust测试并发问题修复方法论\n\n## 问题识别\n1. 症状：测试在完整套件运行时失败，单独运行时通过\n2. 原因：共享全局状态的并发访问导致竞态条件\n3. 常见场景：全局变量、文件系统、数据库连接等共享资源\n\n## 解决流程\n1. **验证问题稳定性**\n   - 多次运行完整测试：`cargo test -- --nocapture`\n   - 单独运行失败测试：`cargo test test_name -- --nocapture`\n\n2. **定位共享资源**\n   - 检查测试用例中的全局变量（如 TMPFILES）\n   - 分析测试间的资源依赖关系\n\n3. **解决方案选择**\n   - **方案A：测试串行化** - 在测试函数上添加 `#[serial]` 属性\n   - **方案B：资源隔离** - 为每个测试创建独立资源实例\n   - **方案C：同步机制** - 使用 Mutex/RwLock 保护共享资源\n   - **方案D：清理策略** - 测试前清理/重置共享状态\n\n4. **验证修复**\n   - 运行完整测试套件多次确认稳定性\n   - 检查是否引入新的测试失败（回归测试）\n\n## 注意事项\n- 优先选择资源隔离（方案B），避免串行化影响测试性能\n- 确保测试清理不会干扰其他测试的正常执行\n- 考虑使用 `tempfile` crate 等工具提供的临时文件管理功能"
}